<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>25&nbsp; Feature engineering in R – Основи роботи з даними в R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./train-test-validation-samples.html" rel="next">
<link href="./44-r-outliers.html" rel="prev">
<link href="./img/favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="css/style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./etl-feature-engineering.html">ТЕМА 5. КОНСТРУЮВАННЯ ОЗНАК</a></li><li class="breadcrumb-item"><a href="./etl-feature-engineering.html"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Feature engineering in R</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Основи роботи з даними в R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/kleban/data-r/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Про посібник</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Вступ</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">ТЕМА 1. ВСТУП ДО РОБОТИ З ДАНИМИ</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-r-data-read-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Загальна інформація + презентація</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">ТЕМА 2. ЧИТАННЯ ДАНИХ</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-r-data-read-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Загальна інформація + презентація</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-r-csv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">CSV</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-r-xlsx.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">MS Excel (xlsx)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24-r-xml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">XML</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25-r-api-json.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">JSON and API</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./26-r-google.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Google Services</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./27-r-sql.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">SQL (with SQLite sample)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./28-r-html.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Web-pages (HTML)</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">ТЕМА 3. МАНІПУЛЮВАННЯ ДАНИМИ У <code>dplyr</code></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./30-r-what-is-dplyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">What’s <code>dplyr</code> package [EN]</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./31-r-data-explore.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Exploring data with <code>dplyr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./32-r-data-slice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Subset rows with <code>slice()</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./33-r-data-sorting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Sorting with <strong><code>arrange()</code></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./34-r-data-mutating.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Create new variables with <strong><code>mutate()</code></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./35-r-data-rename.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Renaming columns with <strong><code>rename()</code></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./36-r-data-grouping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Grouping columns with <strong><code>dplyr</code></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./37-r-data-bind.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Binding rows and columns</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./38-r-data-join.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title"><code>Join()</code>-ing data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./39-r-wide-to-long.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Wide-to-long tables</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">ТЕМА 4. СПОСОБИ ОЧИСТКИ ДАНИХ</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./40-r-data-quality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Оцінки якості даних</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./41-r-data-naming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Робота з неіменованими та “поганоіменованими” даними</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./42-r-cleaning-text.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Підготовка та очистка текстової інформації</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./43-r-missing-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Заміна пропусків у даних (Missing Value Imputation)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./44-r-outliers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Аналіз та обробка статистичних викидів у даних</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">ТЕМА 5. КОНСТРУЮВАННЯ ОЗНАК</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./etl-feature-engineering.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Feature engineering in R</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">ТЕМА 6. ПОДІЛ ВИБІРКИ</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./train-test-validation-samples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Data Split: Train, Test and Validation sets</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">ТЕМА 7. ОГЛЯДОВИЙ АНАЛІЗ ДАНИХ</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">EDA на прикладі вина</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eda-charts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">EDA, робота з ggplot2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eda-dlookr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">EDA з dlookR</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./edainspectdf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">EDA з використанням inspectdf</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Список використаних джерел</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Зміст</h2>
   
  <ul>
  <li><a href="#whats-feature-engineering" id="toc-whats-feature-engineering" class="nav-link active" data-scroll-target="#whats-feature-engineering"><span class="header-section-number">25.1</span> What’s Feature Engineering?</a></li>
  <li><a href="#feature-scaling" id="toc-feature-scaling" class="nav-link" data-scroll-target="#feature-scaling"><span class="header-section-number">25.2</span> Feature Scaling</a>
  <ul class="collapse">
  <li><a href="#normalization" id="toc-normalization" class="nav-link" data-scroll-target="#normalization"><span class="header-section-number">25.2.1</span> Normalization</a></li>
  <li><a href="#standardization" id="toc-standardization" class="nav-link" data-scroll-target="#standardization"><span class="header-section-number">25.2.2</span> Standardization</a></li>
  <li><a href="#scaling-for-traintestvalidationprediction" id="toc-scaling-for-traintestvalidationprediction" class="nav-link" data-scroll-target="#scaling-for-traintestvalidationprediction"><span class="header-section-number">25.2.3</span> Scaling for train/test/validation/prediction</a></li>
  </ul></li>
  <li><a href="#feature-transformation" id="toc-feature-transformation" class="nav-link" data-scroll-target="#feature-transformation"><span class="header-section-number">25.3</span> Feature Transformation</a>
  <ul class="collapse">
  <li><a href="#scaling-based-on-calculations" id="toc-scaling-based-on-calculations" class="nav-link" data-scroll-target="#scaling-based-on-calculations"><span class="header-section-number">25.3.1</span> Scaling based on calculations</a></li>
  </ul></li>
  <li><a href="#feature-construction" id="toc-feature-construction" class="nav-link" data-scroll-target="#feature-construction"><span class="header-section-number">25.4</span> Feature Construction</a>
  <ul class="collapse">
  <li><a href="#binning" id="toc-binning" class="nav-link" data-scroll-target="#binning"><span class="header-section-number">25.4.1</span> Binning</a></li>
  <li><a href="#evaluate-data-on-raw-dataset" id="toc-evaluate-data-on-raw-dataset" class="nav-link" data-scroll-target="#evaluate-data-on-raw-dataset"><span class="header-section-number">25.4.2</span> Evaluate data on raw dataset</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">25.5</span> References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./etl-feature-engineering.html">ТЕМА 5. КОНСТРУЮВАННЯ ОЗНАК</a></li><li class="breadcrumb-item"><a href="./etl-feature-engineering.html"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Feature engineering in R</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Feature engineering in R</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<hr>
<p>You need this packages for code execution:</p>
<div id="d361f1c1-aa17-4725-93a7-cebfa7346de8" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># install.packages("ggplot2")</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">install.packages</span>(<span class="st">"gridExtra"</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co"># install.packages("scorecard")</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co"># install.packages("caret")</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co"># install.packages("gmodels")</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co"># install.packages("superml") #you olso need R6 package</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>package 'gridExtra' successfully unpacked and MD5 sums checked

The downloaded binary packages are in
    D:\Temp\Rtmpum9OKD\downloaded_packages</code></pre>
</div>
</div>
<div id="1ac6b485-826c-4e3c-aa8f-43a533eb22ab" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">invisible</span>(<span class="fu">Sys.setlocale</span>(<span class="st">"LC_ALL"</span>, <span class="st">"Ukrainian"</span>))</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">invisible</span>(<span class="fu">options</span>(<span class="at">warn=</span><span class="sc">-</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<section id="whats-feature-engineering" class="level2" data-number="25.1">
<h2 data-number="25.1" class="anchored" data-anchor-id="whats-feature-engineering"><span class="header-section-number">25.1</span> What’s Feature Engineering?</h2>
<p><code>Feature engineering</code> is the most important technique used in creating machine learning models.</p>
<p>Feature Engineering is a basic term used to cover many operations that are performed on the variables(features) to fit them into the algorithm. <strong>It helps in increasing the accuracy</strong> of the model thereby enhances the results of the predictions. Feature Engineered machine learning models perform better on data than basic machine learning models. The following aspects of feature engineering are as follows [1]:</p>
<ol type="1">
<li><code>Feature Scaling</code>: It is done to get the features on the same scale( for eg. Euclidean distance).</li>
<li><code>Feature Transformation</code>: It is done to normalize the data(feature) by a function.</li>
<li><code>Feature Construction</code>: It is done to create new features based on original descriptors to improve the accuracy of the predictive model.</li>
</ol>
<p>A <code>"feature"</code> in the context of predictive modeling is just another name for a <code>predictor variable</code>. Feature engineering is the general term for creating and manipulating predictors so that a good predictive model can be created.</p>
<hr>
</section>
<section id="feature-scaling" class="level2" data-number="25.2">
<h2 data-number="25.2" class="anchored" data-anchor-id="feature-scaling"><span class="header-section-number">25.2</span> Feature Scaling</h2>
<p><code>Feature Scaling</code> refers to putting the values in the same range or same scale so that no variable is dominated by the other.</p>
<p>Most of the times, your dataset will contain features highly varying in magnitudes, units and range. But since, most of the machine learning algorithms use Euclidean distance between two data points in their computations, this is a problem.</p>
<p>If left alone, these algorithms only take in the magnitude of features neglecting the units. The results would vary greatly between different units, 5kg and 5000gms. The features with high magnitudes will weigh in a lot more in the distance calculations than features with low magnitudes. To suppress this effect, we need to bring all features to the same level of magnitudes. This can be achieved by scaling.</p>
<p>Here’s the curious thing about feature scaling – it improves (significantly) the performance of some machine learning algorithms and does not work at all for others.</p>
<p>Also, what’s the difference between normalization and standardization? These are two of the most commonly used feature scaling techniques in machine learning but a level of ambiguity exists in their understanding.</p>
<hr>
<section id="normalization" class="level3" data-number="25.2.1">
<h3 data-number="25.2.1" class="anchored" data-anchor-id="normalization"><span class="header-section-number">25.2.1</span> Normalization</h3>
<section id="theory" class="level4" data-number="25.2.1.1">
<h4 data-number="25.2.1.1" class="anchored" data-anchor-id="theory"><span class="header-section-number">25.2.1.1</span> Theory</h4>
<p><strong>Normalization</strong> is a scaling technique in which values are shifted and rescaled so that they end up ranging between 0 and 1. It is also known as <strong><code>Min-Max scaling</code></strong>.</p>
<p>Here’s the formula for normalization:</p>
<center>
<span class="math inline">\(X' = \frac{X-X_{min}}{X_{max} - X_{min}}\)</span>
</center>
<p>Here, <span class="math inline">\(X_{max}\)</span> and <span class="math inline">\(X_{min}\)</span> are the maximum and the minimum values of the feature respectively.</p>
<p>When the value of <span class="math inline">\(X\)</span> is the minimum value in the column, the numerator will be <span class="math inline">\(0\)</span>, and hence <span class="math inline">\(X'\)</span> is <span class="math inline">\(0\)</span>.</p>
<p>On the other hand, when the value of <span class="math inline">\(X\)</span> is the maximum value in the column, the numerator is equal to the denominator and thus the value of <span class="math inline">\(X'\)</span> is <span class="math inline">\(1\)</span>.</p>
<p>If the value of <span class="math inline">\(X\)</span> is between the minimum and the maximum value, then the value of <span class="math inline">\(X'\)</span> is between <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span>.</p>
<hr>
</section>
<section id="practice" class="level4" data-number="25.2.1.2">
<h4 data-number="25.2.1.2" class="anchored" data-anchor-id="practice"><span class="header-section-number">25.2.1.2</span> Practice</h4>
<p>So, let’s implement own normalization function.</p>
<div id="ccfb0a45" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Lets use client churn dataset from telco: https://www.kaggle.com/blastchar/telco-customer-churn</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>churn_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/telecom_users.csv"</span>)</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="fu">head</span>(churn_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 6 × 22</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">X</th>
<th data-quarto-table-cell-role="th" scope="col">customerID</th>
<th data-quarto-table-cell-role="th" scope="col">gender</th>
<th data-quarto-table-cell-role="th" scope="col">SeniorCitizen</th>
<th data-quarto-table-cell-role="th" scope="col">Partner</th>
<th data-quarto-table-cell-role="th" scope="col">Dependents</th>
<th data-quarto-table-cell-role="th" scope="col">tenure</th>
<th data-quarto-table-cell-role="th" scope="col">PhoneService</th>
<th data-quarto-table-cell-role="th" scope="col">MultipleLines</th>
<th data-quarto-table-cell-role="th" scope="col">InternetService</th>
<th data-quarto-table-cell-role="th" scope="col">⋯</th>
<th data-quarto-table-cell-role="th" scope="col">DeviceProtection</th>
<th data-quarto-table-cell-role="th" scope="col">TechSupport</th>
<th data-quarto-table-cell-role="th" scope="col">StreamingTV</th>
<th data-quarto-table-cell-role="th" scope="col">StreamingMovies</th>
<th data-quarto-table-cell-role="th" scope="col">Contract</th>
<th data-quarto-table-cell-role="th" scope="col">PaperlessBilling</th>
<th data-quarto-table-cell-role="th" scope="col">PaymentMethod</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyCharges</th>
<th data-quarto-table-cell-role="th" scope="col">TotalCharges</th>
<th data-quarto-table-cell-role="th" scope="col">Churn</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">⋯</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">1</td>
<td>1869</td>
<td>7010-BRBUU</td>
<td>Male</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>72</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>⋯</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Credit card (automatic)</td>
<td>24.1</td>
<td>1734.65</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">2</td>
<td>4528</td>
<td>9688-YGXVR</td>
<td>Female</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>44</td>
<td>Yes</td>
<td>No</td>
<td>Fiber optic</td>
<td>⋯</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Credit card (automatic)</td>
<td>88.15</td>
<td>3973.20</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">3</td>
<td>6344</td>
<td>9286-DOJGF</td>
<td>Female</td>
<td>1</td>
<td>Yes</td>
<td>No</td>
<td>38</td>
<td>Yes</td>
<td>Yes</td>
<td>Fiber optic</td>
<td>⋯</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>74.95</td>
<td>2869.85</td>
<td>Yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">4</td>
<td>6739</td>
<td>6994-KERXL</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>4</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>⋯</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>55.9</td>
<td>238.50</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">5</td>
<td>432</td>
<td>2181-UAESM</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>2</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>⋯</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>No</td>
<td>Electronic check</td>
<td>53.45</td>
<td>119.50</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">6</td>
<td>2215</td>
<td>4312-GVYNH</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>70</td>
<td>No</td>
<td>No phone service</td>
<td>DSL</td>
<td>⋯</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td>Two year</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>49.85</td>
<td>3370.20</td>
<td>No</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="c6d7e7b4" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">str</span>(churn_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   5986 obs. of  22 variables:
 $ X               : int  1869 4528 6344 6739 432 2215 5260 6001 1480 5137 ...
 $ customerID      : chr  "7010-BRBUU" "9688-YGXVR" "9286-DOJGF" "6994-KERXL" ...
 $ gender          : chr  "Male" "Female" "Female" "Male" ...
 $ SeniorCitizen   : int  0 0 1 0 0 0 0 0 0 1 ...
 $ Partner         : chr  "Yes" "No" "Yes" "No" ...
 $ Dependents      : chr  "Yes" "No" "No" "No" ...
 $ tenure          : int  72 44 38 4 2 70 33 1 39 55 ...
 $ PhoneService    : chr  "Yes" "Yes" "Yes" "Yes" ...
 $ MultipleLines   : chr  "Yes" "No" "Yes" "No" ...
 $ InternetService : chr  "No" "Fiber optic" "Fiber optic" "DSL" ...
 $ OnlineSecurity  : chr  "No internet service" "No" "No" "No" ...
 $ OnlineBackup    : chr  "No internet service" "Yes" "No" "No" ...
 $ DeviceProtection: chr  "No internet service" "Yes" "No" "No" ...
 $ TechSupport     : chr  "No internet service" "No" "No" "No" ...
 $ StreamingTV     : chr  "No internet service" "Yes" "No" "No" ...
 $ StreamingMovies : chr  "No internet service" "No" "No" "Yes" ...
 $ Contract        : chr  "Two year" "Month-to-month" "Month-to-month" "Month-to-month" ...
 $ PaperlessBilling: chr  "No" "Yes" "Yes" "Yes" ...
 $ PaymentMethod   : chr  "Credit card (automatic)" "Credit card (automatic)" "Bank transfer (automatic)" "Electronic check" ...
 $ MonthlyCharges  : chr  "24.1" "88.15" "74.95" "55.9" ...
 $ TotalCharges    : num  1735 3973 2870 238 120 ...
 $ Churn           : chr  "No" "No" "Yes" "No" ...</code></pre>
</div>
</div>
<div id="0f7cb68e" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># next check summary of values</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="fu">summary</span>(churn_data)</span>
<span id="cb7-3"><a href="#cb7-3"></a></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co"># check TotalCharges field</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>       X         customerID           gender          SeniorCitizen   
 Min.   :   0   Length:5986        Length:5986        Min.   :0.0000  
 1st Qu.:1777   Class :character   Class :character   1st Qu.:0.0000  
 Median :3546   Mode  :character   Mode  :character   Median :0.0000  
 Mean   :3534                                         Mean   :0.1614  
 3rd Qu.:5292                                         3rd Qu.:0.0000  
 Max.   :7042                                         Max.   :1.0000  
                                                                      
   Partner           Dependents            tenure      PhoneService      
 Length:5986        Length:5986        Min.   : 0.00   Length:5986       
 Class :character   Class :character   1st Qu.: 9.00   Class :character  
 Mode  :character   Mode  :character   Median :29.00   Mode  :character  
                                       Mean   :32.47                     
                                       3rd Qu.:56.00                     
                                       Max.   :72.00                     
                                                                         
 MultipleLines      InternetService    OnlineSecurity     OnlineBackup      
 Length:5986        Length:5986        Length:5986        Length:5986       
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
                                                                            
 DeviceProtection   TechSupport        StreamingTV        StreamingMovies   
 Length:5986        Length:5986        Length:5986        Length:5986       
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
                                                                            
   Contract         PaperlessBilling   PaymentMethod      MonthlyCharges    
 Length:5986        Length:5986        Length:5986        Length:5986       
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
                                                                            
  TotalCharges       Churn          
 Min.   :  18.8   Length:5986       
 1st Qu.: 404.3   Class :character  
 Median :1412.2   Mode  :character  
 Mean   :2298.1                     
 3rd Qu.:3847.0                     
 Max.   :8684.8                     
 NA's   :10                         </code></pre>
</div>
</div>
<p>Next, lets build histogram of <code>Income</code> and check how it splited with <code>ggplot2</code>:</p>
<div id="1cada0a3" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co">#install.packages("ggplot2")</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>ggplot()</code> - function for building charts</p>
<p><code>data</code> - first parameter - dataset</p>
<p><code>aes()</code> - authetics - visualition axis / Construct aesthetic mappings</p>
<p><code>geom_CHART_TYPE()</code> - set the chart type</p>
<p><code>geom_histogram()</code> - Histograms and frequency polygons</p>
<p>//<code>theme_set()</code> - theme configutation</p>
<div id="085c1ffb" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="fu">ggplot</span>(<span class="at">data =</span> churn_data, <span class="fu">aes</span>(<span class="at">x=</span>TotalCharges)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">15</span>)</span>
<span id="cb10-3"><a href="#cb10-3"></a></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="co"># try theme</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning message:
"Removed 10 rows containing non-finite values (stat_bin)."</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etl-feature-engineering_files/figure-html/cell-8-output-2.png" width="420" height="420" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="f7394ee5" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># Lets replace missing with 0 zero for TotalCharges </span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="fu">library</span>(magrittr) <span class="co"># if pipe not loaded</span></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="fu">library</span>(dplyr) <span class="co"># for mutate function</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>churn_data <span class="ot">&lt;-</span> churn_data <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>            <span class="fu">mutate</span>(<span class="at">TotalCharges =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(TotalCharges), <span class="dv">0</span> , TotalCharges))</span>
<span id="cb12-6"><a href="#cb12-6"></a></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="fu">ggplot</span>(churn_data, <span class="fu">aes</span>(<span class="at">x=</span>TotalCharges)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'


The following objects are masked from 'package:stats':

    filter, lag


The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union

</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etl-feature-engineering_files/figure-html/cell-9-output-2.png" width="420" height="420" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="1bb2f96f" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Lets implement own normalization function by fomula explained earlie</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>normalizeData <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb14-3"><a href="#cb14-3"></a>    <span class="fu">return</span> ((x <span class="sc">-</span> <span class="fu">min</span>(x)) <span class="sc">/</span> (<span class="fu">max</span>(x) <span class="sc">-</span> <span class="fu">min</span>(x)))</span>
<span id="cb14-4"><a href="#cb14-4"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="e4717efd" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="co"># Normalize TotalCharges</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>churn_data <span class="ot">&lt;-</span> churn_data <span class="sc">|&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(TotalCharges)) <span class="sc">|&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>    <span class="fu">mutate</span>(<span class="at">TotalChargesNorm =</span> <span class="fu">normalizeData</span>(TotalCharges))</span>
<span id="cb15-6"><a href="#cb15-6"></a></span>
<span id="cb15-7"><a href="#cb15-7"></a>churn_data <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co"># check the last columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 6 × 23</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">X</th>
<th data-quarto-table-cell-role="th" scope="col">customerID</th>
<th data-quarto-table-cell-role="th" scope="col">gender</th>
<th data-quarto-table-cell-role="th" scope="col">SeniorCitizen</th>
<th data-quarto-table-cell-role="th" scope="col">Partner</th>
<th data-quarto-table-cell-role="th" scope="col">Dependents</th>
<th data-quarto-table-cell-role="th" scope="col">tenure</th>
<th data-quarto-table-cell-role="th" scope="col">PhoneService</th>
<th data-quarto-table-cell-role="th" scope="col">MultipleLines</th>
<th data-quarto-table-cell-role="th" scope="col">InternetService</th>
<th data-quarto-table-cell-role="th" scope="col">⋯</th>
<th data-quarto-table-cell-role="th" scope="col">TechSupport</th>
<th data-quarto-table-cell-role="th" scope="col">StreamingTV</th>
<th data-quarto-table-cell-role="th" scope="col">StreamingMovies</th>
<th data-quarto-table-cell-role="th" scope="col">Contract</th>
<th data-quarto-table-cell-role="th" scope="col">PaperlessBilling</th>
<th data-quarto-table-cell-role="th" scope="col">PaymentMethod</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyCharges</th>
<th data-quarto-table-cell-role="th" scope="col">TotalCharges</th>
<th data-quarto-table-cell-role="th" scope="col">Churn</th>
<th data-quarto-table-cell-role="th" scope="col">TotalChargesNorm</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">⋯</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">1</td>
<td>1869</td>
<td>7010-BRBUU</td>
<td>Male</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>72</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>⋯</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Credit card (automatic)</td>
<td>24.1</td>
<td>1734.65</td>
<td>No</td>
<td>0.19799792</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">2</td>
<td>4528</td>
<td>9688-YGXVR</td>
<td>Female</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>44</td>
<td>Yes</td>
<td>No</td>
<td>Fiber optic</td>
<td>⋯</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Credit card (automatic)</td>
<td>88.15</td>
<td>3973.20</td>
<td>No</td>
<td>0.45631202</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">3</td>
<td>6344</td>
<td>9286-DOJGF</td>
<td>Female</td>
<td>1</td>
<td>Yes</td>
<td>No</td>
<td>38</td>
<td>Yes</td>
<td>Yes</td>
<td>Fiber optic</td>
<td>⋯</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>74.95</td>
<td>2869.85</td>
<td>Yes</td>
<td>0.32899261</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">4</td>
<td>6739</td>
<td>6994-KERXL</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>4</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>⋯</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>55.9</td>
<td>238.50</td>
<td>No</td>
<td>0.02535195</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">5</td>
<td>432</td>
<td>2181-UAESM</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>2</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>⋯</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>No</td>
<td>Electronic check</td>
<td>53.45</td>
<td>119.50</td>
<td>No</td>
<td>0.01162012</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">6</td>
<td>2215</td>
<td>4312-GVYNH</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>70</td>
<td>No</td>
<td>No phone service</td>
<td>DSL</td>
<td>⋯</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td>Two year</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>49.85</td>
<td>3370.20</td>
<td>No</td>
<td>0.38672975</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="ed864787" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co">#summary for the last field</span></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="fu">summary</span>(churn_data<span class="sc">$</span>TotalChargesNorm)</span>
<span id="cb16-3"><a href="#cb16-3"></a></span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="co">#its from 1 to zero</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.00000 0.04449 0.16078 0.26301 0.44174 1.00000 </code></pre>
</div>
</div>
<div id="5e618b0e" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># And lets make a histogram</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="fu">ggplot</span>(churn_data, <span class="fu">aes</span>(<span class="at">x=</span>TotalChargesNorm)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etl-feature-engineering_files/figure-html/cell-14-output-1.png" width="420" height="420" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We observe identical histograms even though the <code>TotalCharges / TotalChargesNorm</code> axis is rescaled.</p>
<p>Therefore we show that <strong>normalization didn’t affect the distribution properties</strong> of the rescaled data.</p>
<hr>
</section>
</section>
<section id="standardization" class="level3" data-number="25.2.2">
<h3 data-number="25.2.2" class="anchored" data-anchor-id="standardization"><span class="header-section-number">25.2.2</span> Standardization</h3>
<section id="theory-1" class="level4" data-number="25.2.2.1">
<h4 data-number="25.2.2.1" class="anchored" data-anchor-id="theory-1"><span class="header-section-number">25.2.2.1</span> Theory</h4>
<p><code>Standardization</code> is another scaling technique where the values are centered around the mean with a unit standard deviation. This means that the mean of the attribute becomes zero and the resultant distribution has a unit standard deviation.</p>
<p>Here’s the formula for standardization:</p>
<center>
<span class="math inline">\(X' = \frac{X-\mu}{\sigma}\)</span>
</center>
<p>Feature scaling: <span class="math inline">\(\mu\)</span> is the mean of the feature values and Feature scaling: <span class="math inline">\(\sigma\)</span> is the standard deviation of the feature values. Note that in this case, the values are not restricted to a particular range.</p>
<p>Now, the big question in your mind must be when should we use normalization and when should we use standardization?</p>
<p>Normalization vs.&nbsp;standardization is an eternal question among machine learning newcomers. Let me elaborate on the answer in this section.</p>
<p>Normalization is good to use when you know that the distribution of your data does not follow a Gaussian distribution. This can be useful in algorithms that do not assume any distribution of the data like K-Nearest Neighbors and Neural Networks.</p>
<p>Standardization, on the other hand, can be helpful in cases where the data follows a Gaussian distribution. However, this does not have to be necessarily true. Also, unlike normalization, standardization does not have a bounding range. So, even if you have outliers in your data, they will not be affected by standardization. However, at the end of the day, the choice of using normalization or standardization will depend on your problem and the machine learning algorithm you are using. There is no hard and fast rule to tell you when to normalize or standardize your data. You can always start by fitting your model to raw, normalized and standardized data and compare the performance for best results.</p>
<p>It is a good practice to fit the scaler on the training data and then use it to transform the testing data. This would avoid any data leakage during the model testing process. Also, the scaling of target values is generally not required.</p>
<hr>
</section>
<section id="practice-1" class="level4" data-number="25.2.2.2">
<h4 data-number="25.2.2.2" class="anchored" data-anchor-id="practice-1"><span class="header-section-number">25.2.2.2</span> Practice</h4>
<p>Lets write own function for standartization:</p>
<div id="ab7fc87d" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># if sdev is NA - calculate start deviation from data</span></span>
<span id="cb19-2"><a href="#cb19-2"></a></span>
<span id="cb19-3"><a href="#cb19-3"></a>standartize <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {    </span>
<span id="cb19-4"><a href="#cb19-4"></a>    sdev <span class="ot">=</span> <span class="fu">sd</span>(data, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)  </span>
<span id="cb19-5"><a href="#cb19-5"></a>    data <span class="ot">&lt;-</span> (data <span class="sc">-</span> <span class="fu">mean</span>(data, <span class="at">na.rm =</span> T)) <span class="sc">/</span> sdev</span>
<span id="cb19-6"><a href="#cb19-6"></a>    <span class="fu">return</span> (data)    </span>
<span id="cb19-7"><a href="#cb19-7"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="647ae12a" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># Normalize TotalCharges</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>churn_data <span class="ot">&lt;-</span> churn_data <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3"></a>    <span class="fu">mutate</span>(<span class="at">TotalChargesStand =</span> <span class="fu">standartize</span>(TotalCharges))</span>
<span id="cb20-4"><a href="#cb20-4"></a></span>
<span id="cb20-5"><a href="#cb20-5"></a>churn_data <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co"># check the last columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 6 × 24</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">X</th>
<th data-quarto-table-cell-role="th" scope="col">customerID</th>
<th data-quarto-table-cell-role="th" scope="col">gender</th>
<th data-quarto-table-cell-role="th" scope="col">SeniorCitizen</th>
<th data-quarto-table-cell-role="th" scope="col">Partner</th>
<th data-quarto-table-cell-role="th" scope="col">Dependents</th>
<th data-quarto-table-cell-role="th" scope="col">tenure</th>
<th data-quarto-table-cell-role="th" scope="col">PhoneService</th>
<th data-quarto-table-cell-role="th" scope="col">MultipleLines</th>
<th data-quarto-table-cell-role="th" scope="col">InternetService</th>
<th data-quarto-table-cell-role="th" scope="col">⋯</th>
<th data-quarto-table-cell-role="th" scope="col">StreamingTV</th>
<th data-quarto-table-cell-role="th" scope="col">StreamingMovies</th>
<th data-quarto-table-cell-role="th" scope="col">Contract</th>
<th data-quarto-table-cell-role="th" scope="col">PaperlessBilling</th>
<th data-quarto-table-cell-role="th" scope="col">PaymentMethod</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyCharges</th>
<th data-quarto-table-cell-role="th" scope="col">TotalCharges</th>
<th data-quarto-table-cell-role="th" scope="col">Churn</th>
<th data-quarto-table-cell-role="th" scope="col">TotalChargesNorm</th>
<th data-quarto-table-cell-role="th" scope="col">TotalChargesStand</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">⋯</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">1</td>
<td>1869</td>
<td>7010-BRBUU</td>
<td>Male</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>72</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>⋯</td>
<td>No internet service</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Credit card (automatic)</td>
<td>24.1</td>
<td>1734.65</td>
<td>No</td>
<td>0.19799792</td>
<td>-0.2477481</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">2</td>
<td>4528</td>
<td>9688-YGXVR</td>
<td>Female</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>44</td>
<td>Yes</td>
<td>No</td>
<td>Fiber optic</td>
<td>⋯</td>
<td>Yes</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Credit card (automatic)</td>
<td>88.15</td>
<td>3973.20</td>
<td>No</td>
<td>0.45631202</td>
<td>0.7366076</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">3</td>
<td>6344</td>
<td>9286-DOJGF</td>
<td>Female</td>
<td>1</td>
<td>Yes</td>
<td>No</td>
<td>38</td>
<td>Yes</td>
<td>Yes</td>
<td>Fiber optic</td>
<td>⋯</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>74.95</td>
<td>2869.85</td>
<td>Yes</td>
<td>0.32899261</td>
<td>0.2514325</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">4</td>
<td>6739</td>
<td>6994-KERXL</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>4</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>⋯</td>
<td>No</td>
<td>Yes</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>55.9</td>
<td>238.50</td>
<td>No</td>
<td>0.02535195</td>
<td>-0.9056488</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">5</td>
<td>432</td>
<td>2181-UAESM</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>2</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>⋯</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>No</td>
<td>Electronic check</td>
<td>53.45</td>
<td>119.50</td>
<td>No</td>
<td>0.01162012</td>
<td>-0.9579766</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">6</td>
<td>2215</td>
<td>4312-GVYNH</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>70</td>
<td>No</td>
<td>No phone service</td>
<td>DSL</td>
<td>⋯</td>
<td>No</td>
<td>Yes</td>
<td>Two year</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>49.85</td>
<td>3370.20</td>
<td>No</td>
<td>0.38672975</td>
<td>0.4714509</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Lets compare data distribution fot normalization and standartization.</p>
<div id="a17716a4" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co">#install.packages("gridExtra") # to view 2+ ggplots </span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb21-3"><a href="#cb21-3"></a>n_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(churn_data, <span class="fu">aes</span>(<span class="at">x=</span>TotalChargesNorm)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">15</span>)</span>
<span id="cb21-4"><a href="#cb21-4"></a>s_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(churn_data, <span class="fu">aes</span>(<span class="at">x=</span>TotalChargesStand)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">15</span>)</span>
<span id="cb21-5"><a href="#cb21-5"></a>init_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(churn_data, <span class="fu">aes</span>(<span class="at">x=</span>TotalCharges)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">15</span>)</span>
<span id="cb21-6"><a href="#cb21-6"></a><span class="fu">grid.arrange</span>(n_plot, init_plot, s_plot, <span class="at">ncol=</span><span class="dv">3</span>) <span class="co"># from gridExtra</span></span>
<span id="cb21-7"><a href="#cb21-7"></a></span>
<span id="cb21-8"><a href="#cb21-8"></a><span class="co"># data distribution changed after standartisation scaling</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'gridExtra'


The following object is masked from 'package:dplyr':

    combine

</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etl-feature-engineering_files/figure-html/cell-17-output-2.png" width="420" height="420" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>So, lets use stardart <code>R</code> function for scaling and compare results:</p>
<div id="8b4c6239" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># the next </span></span>
<span id="cb23-2"><a href="#cb23-2"></a>churn_data <span class="ot">&lt;-</span> churn_data <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3"></a>        <span class="fu">mutate</span>(<span class="at">TotalChargesScaled =</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(TotalCharges))) </span>
<span id="cb23-4"><a href="#cb23-4"></a></span>
<span id="cb23-5"><a href="#cb23-5"></a>s1_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(churn_data, <span class="fu">aes</span>(<span class="at">x=</span>TotalChargesStand)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">15</span>)</span>
<span id="cb23-6"><a href="#cb23-6"></a>s2_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(churn_data, <span class="fu">aes</span>(<span class="at">x=</span>TotalChargesScaled)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">15</span>)</span>
<span id="cb23-7"><a href="#cb23-7"></a><span class="fu">grid.arrange</span>(s1_plot, s2_plot, <span class="at">ncol=</span><span class="dv">2</span>) <span class="co"># it looks like we created the same function </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etl-feature-engineering_files/figure-html/cell-18-output-1.png" width="420" height="420" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="d18e8907" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="fu">mean</span>(churn_data<span class="sc">$</span>TotalCharges)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
2298.06061746988
</div>
</div>
<p>Look like default function has the same result as our.</p>
<div id="743e9970" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="fu">head</span>(churn_data) <span class="co"># check last two columns, its the same</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 6 × 25</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">X</th>
<th data-quarto-table-cell-role="th" scope="col">customerID</th>
<th data-quarto-table-cell-role="th" scope="col">gender</th>
<th data-quarto-table-cell-role="th" scope="col">SeniorCitizen</th>
<th data-quarto-table-cell-role="th" scope="col">Partner</th>
<th data-quarto-table-cell-role="th" scope="col">Dependents</th>
<th data-quarto-table-cell-role="th" scope="col">tenure</th>
<th data-quarto-table-cell-role="th" scope="col">PhoneService</th>
<th data-quarto-table-cell-role="th" scope="col">MultipleLines</th>
<th data-quarto-table-cell-role="th" scope="col">InternetService</th>
<th data-quarto-table-cell-role="th" scope="col">...</th>
<th data-quarto-table-cell-role="th" scope="col">StreamingMovies</th>
<th data-quarto-table-cell-role="th" scope="col">Contract</th>
<th data-quarto-table-cell-role="th" scope="col">PaperlessBilling</th>
<th data-quarto-table-cell-role="th" scope="col">PaymentMethod</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyCharges</th>
<th data-quarto-table-cell-role="th" scope="col">TotalCharges</th>
<th data-quarto-table-cell-role="th" scope="col">Churn</th>
<th data-quarto-table-cell-role="th" scope="col">TotalChargesNorm</th>
<th data-quarto-table-cell-role="th" scope="col">TotalChargesStand</th>
<th data-quarto-table-cell-role="th" scope="col">TotalChargesScaled</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">...</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">1</td>
<td>1869</td>
<td>7010-BRBUU</td>
<td>Male</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>72</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>...</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Credit card (automatic)</td>
<td>24.1</td>
<td>1734.65</td>
<td>No</td>
<td>0.19973402</td>
<td>-0.2460559</td>
<td>-0.2460559</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">2</td>
<td>4528</td>
<td>9688-YGXVR</td>
<td>Female</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>44</td>
<td>Yes</td>
<td>No</td>
<td>Fiber optic</td>
<td>...</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Credit card (automatic)</td>
<td>88.15</td>
<td>3973.20</td>
<td>No</td>
<td>0.45748895</td>
<td>0.7382838</td>
<td>0.7382838</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">3</td>
<td>6344</td>
<td>9286-DOJGF</td>
<td>Female</td>
<td>1</td>
<td>Yes</td>
<td>No</td>
<td>38</td>
<td>Yes</td>
<td>Yes</td>
<td>Fiber optic</td>
<td>...</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>74.95</td>
<td>2869.85</td>
<td>Yes</td>
<td>0.33044515</td>
<td>0.2531165</td>
<td>0.2531165</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">4</td>
<td>6739</td>
<td>6994-KERXL</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>4</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>...</td>
<td>Yes</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>55.9</td>
<td>238.50</td>
<td>No</td>
<td>0.02746177</td>
<td>-0.9039460</td>
<td>-0.9039460</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">5</td>
<td>432</td>
<td>2181-UAESM</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>2</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>...</td>
<td>No</td>
<td>Month-to-month</td>
<td>No</td>
<td>Electronic check</td>
<td>53.45</td>
<td>119.50</td>
<td>No</td>
<td>0.01375967</td>
<td>-0.9562729</td>
<td>-0.9562729</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">6</td>
<td>2215</td>
<td>4312-GVYNH</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>70</td>
<td>No</td>
<td>No phone service</td>
<td>DSL</td>
<td>...</td>
<td>Yes</td>
<td>Two year</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>49.85</td>
<td>3370.20</td>
<td>No</td>
<td>0.38805730</td>
<td>0.4731314</td>
<td>0.4731314</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr>
</section>
</section>
<section id="scaling-for-traintestvalidationprediction" class="level3" data-number="25.2.3">
<h3 data-number="25.2.3" class="anchored" data-anchor-id="scaling-for-traintestvalidationprediction"><span class="header-section-number">25.2.3</span> Scaling for train/test/validation/prediction</h3>
<p>If you use scaling initial parameters should be remembered somewhere for future prediction data and reimplemented for new/test/validation/prediction dataset</p>
<p>For experiment lets split our dataset for train and test:</p>
<div id="511ace67" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="fu">set.seed</span>(<span class="dv">2021</span>)</span>
<span id="cb26-3"><a href="#cb26-3"></a> </span>
<span id="cb26-4"><a href="#cb26-4"></a>index <span class="ot">=</span> <span class="fu">createDataPartition</span>(churn_data<span class="sc">$</span>Churn, <span class="at">p =</span> <span class="fl">0.70</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-5"><a href="#cb26-5"></a>train <span class="ot">=</span> churn_data[index, ]</span>
<span id="cb26-6"><a href="#cb26-6"></a>test <span class="ot">=</span> churn_data[<span class="sc">-</span>index, ]</span>
<span id="cb26-7"><a href="#cb26-7"></a></span>
<span id="cb26-8"><a href="#cb26-8"></a><span class="fu">nrow</span>(churn_data)</span>
<span id="cb26-9"><a href="#cb26-9"></a><span class="fu">nrow</span>(train)</span>
<span id="cb26-10"><a href="#cb26-10"></a><span class="fu">nrow</span>(test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lattice
</code></pre>
</div>
<div class="cell-output cell-output-display">
5976
</div>
<div class="cell-output cell-output-display">
4184
</div>
<div class="cell-output cell-output-display">
1792
</div>
</div>
<p>Lets rescale <code>TotalCharges</code> data for training set:</p>
<div id="d3c75ac0" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>train <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">TotalChargesScaled =</span> <span class="fu">scale</span>(TotalCharges))</span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="fu">head</span>(train) <span class="co"># you can see that TotalChangesStand and TotalChangesScaled are different becouse of changed mean and standart deviation of data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 6 × 25</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">X</th>
<th data-quarto-table-cell-role="th" scope="col">customerID</th>
<th data-quarto-table-cell-role="th" scope="col">gender</th>
<th data-quarto-table-cell-role="th" scope="col">SeniorCitizen</th>
<th data-quarto-table-cell-role="th" scope="col">Partner</th>
<th data-quarto-table-cell-role="th" scope="col">Dependents</th>
<th data-quarto-table-cell-role="th" scope="col">tenure</th>
<th data-quarto-table-cell-role="th" scope="col">PhoneService</th>
<th data-quarto-table-cell-role="th" scope="col">MultipleLines</th>
<th data-quarto-table-cell-role="th" scope="col">InternetService</th>
<th data-quarto-table-cell-role="th" scope="col">⋯</th>
<th data-quarto-table-cell-role="th" scope="col">StreamingMovies</th>
<th data-quarto-table-cell-role="th" scope="col">Contract</th>
<th data-quarto-table-cell-role="th" scope="col">PaperlessBilling</th>
<th data-quarto-table-cell-role="th" scope="col">PaymentMethod</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyCharges</th>
<th data-quarto-table-cell-role="th" scope="col">TotalCharges</th>
<th data-quarto-table-cell-role="th" scope="col">Churn</th>
<th data-quarto-table-cell-role="th" scope="col">TotalChargesNorm</th>
<th data-quarto-table-cell-role="th" scope="col">TotalChargesStand</th>
<th data-quarto-table-cell-role="th" scope="col">TotalChargesScaled</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">⋯</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl[,1]&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">1</td>
<td>1869</td>
<td>7010-BRBUU</td>
<td>Male</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>72</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>⋯</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Credit card (automatic)</td>
<td>24.1</td>
<td>1734.65</td>
<td>No</td>
<td>0.19799792</td>
<td>-0.2477481</td>
<td>-0.2500210</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">5</td>
<td>432</td>
<td>2181-UAESM</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>2</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>⋯</td>
<td>No</td>
<td>Month-to-month</td>
<td>No</td>
<td>Electronic check</td>
<td>53.45</td>
<td>119.50</td>
<td>No</td>
<td>0.01162012</td>
<td>-0.9579766</td>
<td>-0.9563465</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">9</td>
<td>1480</td>
<td>8898-KASCD</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>39</td>
<td>No</td>
<td>No phone service</td>
<td>DSL</td>
<td>⋯</td>
<td>No</td>
<td>One year</td>
<td>No</td>
<td>Mailed check</td>
<td>35.55</td>
<td>1309.15</td>
<td>No</td>
<td>0.14889799</td>
<td>-0.4348528</td>
<td>-0.4360975</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">10</td>
<td>5137</td>
<td>8016-NCFVO</td>
<td>Male</td>
<td>1</td>
<td>No</td>
<td>No</td>
<td>55</td>
<td>Yes</td>
<td>Yes</td>
<td>Fiber optic</td>
<td>⋯</td>
<td>Yes</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>116.5</td>
<td>6382.55</td>
<td>No</td>
<td>0.73433533</td>
<td>1.7960690</td>
<td>1.7825644</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">11</td>
<td>3169</td>
<td>4578-PHJYZ</td>
<td>Male</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>52</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>⋯</td>
<td>No</td>
<td>One year</td>
<td>Yes</td>
<td>Electronic check</td>
<td>68.75</td>
<td>3482.85</td>
<td>No</td>
<td>0.39972883</td>
<td>0.5209864</td>
<td>0.5144889</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">12</td>
<td>4653</td>
<td>2091-MJTFX</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>30</td>
<td>No</td>
<td>No phone service</td>
<td>DSL</td>
<td>⋯</td>
<td>Yes</td>
<td>Month-to-month</td>
<td>No</td>
<td>Credit card (automatic)</td>
<td>51.2</td>
<td>1561.50</td>
<td>Yes</td>
<td>0.17801754</td>
<td>-0.3238872</td>
<td>-0.3257417</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>So, for train, test and prediction data we should use the same <code>scaling base</code>, in this case <code>mean</code> and <code>standart deviation</code>.</p>
<p>Correct data scaling code should be like this:</p>
<div id="02f8e5d9" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># fix mean and sd</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>meanTotalCharges <span class="ot">=</span> <span class="fu">mean</span>(train<span class="sc">$</span>TotalCharges, <span class="at">na.rm =</span> T)</span>
<span id="cb29-3"><a href="#cb29-3"></a>sdTotalCharges <span class="ot">=</span> <span class="fu">sd</span>(train<span class="sc">$</span>TotalCharges, <span class="at">na.rm =</span> T)</span>
<span id="cb29-4"><a href="#cb29-4"></a></span>
<span id="cb29-5"><a href="#cb29-5"></a>train <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">TotalChargesScaled =</span> <span class="fu">scale</span>(TotalCharges, <span class="at">center =</span> meanTotalCharges, <span class="at">scale =</span> sdTotalCharges)) <span class="co"># default</span></span>
<span id="cb29-6"><a href="#cb29-6"></a>test <span class="ot">&lt;-</span> test <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">TotalChargesScaled =</span> <span class="fu">scale</span>(TotalCharges, <span class="at">center =</span> meanTotalCharges, <span class="at">scale =</span> sdTotalCharges)) <span class="co"># use parameters of train set</span></span>
<span id="cb29-7"><a href="#cb29-7"></a></span>
<span id="cb29-8"><a href="#cb29-8"></a><span class="fu">sd</span>(train<span class="sc">$</span>TotalChargesScaled)</span>
<span id="cb29-9"><a href="#cb29-9"></a><span class="fu">sd</span>(test<span class="sc">$</span>TotalChargesScaled)</span>
<span id="cb29-10"><a href="#cb29-10"></a></span>
<span id="cb29-11"><a href="#cb29-11"></a><span class="co">#check the same value TotalCharges == 0 in train and set</span></span>
<span id="cb29-12"><a href="#cb29-12"></a><span class="fu">head</span>(train <span class="sc">%&gt;%</span> <span class="fu">filter</span>(TotalCharges <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb29-13"><a href="#cb29-13"></a><span class="fu">head</span>(test <span class="sc">%&gt;%</span> <span class="fu">filter</span>(TotalCharges <span class="sc">==</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
1
</div>
<div class="cell-output cell-output-display">
0.981778490083862
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ERROR while rich displaying an object: Error in apply(apply(col, 2L, format), 1L, paste, collapse = ", "): dim(X) must have a positive length

Traceback:
1. tryCatch(withCallingHandlers({
 .     if (!mime %in% names(repr::mime2repr)) 
 .         stop("No repr_* for mimetype ", mime, " in repr::mime2repr")
 .     rpr &lt;- repr::mime2repr[[mime]](obj)
 .     if (is.null(rpr)) 
 .         return(NULL)
 .     prepare_content(is.raw(rpr), rpr)
 . }, error = error_handler), error = outer_handler)
2. tryCatchList(expr, classes, parentenv, handlers)
3. tryCatchOne(expr, names, parentenv, handlers[[1L]])
4. doTryCatch(return(expr), name, parentenv, handler)
5. withCallingHandlers({
 .     if (!mime %in% names(repr::mime2repr)) 
 .         stop("No repr_* for mimetype ", mime, " in repr::mime2repr")
 .     rpr &lt;- repr::mime2repr[[mime]](obj)
 .     if (is.null(rpr)) 
 .         return(NULL)
 .     prepare_content(is.raw(rpr), rpr)
 . }, error = error_handler)
6. repr::mime2repr[[mime]](obj)
7. repr_text.data.frame(obj)
8. ellip_limit_arr(obj, rows, cols)
9. arr_parts_format(parts)
10. structure(lapply(parts, arr_part_format), omit = attr(parts, 
  .     "omit"))
11. lapply(parts, arr_part_format)
12. FUN(X[[i]], ...)
13. vapply(part, function(col) {
  .     if (is.matrix(col)) 
  .         apply(apply(col, 2L, format), 1L, paste, collapse = ", ")
  .     else format(col)
  . }, character(nrow(part)))
14. FUN(X[[i]], ...)
15. apply(apply(col, 2L, format), 1L, paste, collapse = ", ")
16. stop("dim(X) must have a positive length")
ERROR while rich displaying an object: Error in apply(apply(col, 2L, format), 1L, paste, collapse = ", "): dim(X) must have a positive length

Traceback:
1. tryCatch(withCallingHandlers({
 .     if (!mime %in% names(repr::mime2repr)) 
 .         stop("No repr_* for mimetype ", mime, " in repr::mime2repr")
 .     rpr &lt;- repr::mime2repr[[mime]](obj)
 .     if (is.null(rpr)) 
 .         return(NULL)
 .     prepare_content(is.raw(rpr), rpr)
 . }, error = error_handler), error = outer_handler)
2. tryCatchList(expr, classes, parentenv, handlers)
3. tryCatchOne(expr, names, parentenv, handlers[[1L]])
4. doTryCatch(return(expr), name, parentenv, handler)
5. withCallingHandlers({
 .     if (!mime %in% names(repr::mime2repr)) 
 .         stop("No repr_* for mimetype ", mime, " in repr::mime2repr")
 .     rpr &lt;- repr::mime2repr[[mime]](obj)
 .     if (is.null(rpr)) 
 .         return(NULL)
 .     prepare_content(is.raw(rpr), rpr)
 . }, error = error_handler)
6. repr::mime2repr[[mime]](obj)
7. repr_text.data.frame(obj)
8. ellip_limit_arr(obj, rows, cols)
9. arr_parts_format(parts)
10. structure(lapply(parts, arr_part_format), omit = attr(parts, 
  .     "omit"))
11. lapply(parts, arr_part_format)
12. FUN(X[[i]], ...)
13. vapply(part, function(col) {
  .     if (is.matrix(col)) 
  .         apply(apply(col, 2L, format), 1L, paste, collapse = ", ")
  .     else format(col)
  . }, character(nrow(part)))
14. FUN(X[[i]], ...)
15. apply(apply(col, 2L, format), 1L, paste, collapse = ", ")
16. stop("dim(X) must have a positive length")</code></pre>
</div>
</div>
<div id="3e449176" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="co">#compare it with all dataset TotalCharges == 0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="8e75775f" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="fu">filter</span>(churn_data, TotalCharges <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb32-2"><a href="#cb32-2"></a><span class="co"># for now TotalChargesScaled in train/test th same, but in churn data its different, because of diffrent scaling bases</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 10 × 25</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">X</th>
<th data-quarto-table-cell-role="th" scope="col">customerID</th>
<th data-quarto-table-cell-role="th" scope="col">gender</th>
<th data-quarto-table-cell-role="th" scope="col">SeniorCitizen</th>
<th data-quarto-table-cell-role="th" scope="col">Partner</th>
<th data-quarto-table-cell-role="th" scope="col">Dependents</th>
<th data-quarto-table-cell-role="th" scope="col">tenure</th>
<th data-quarto-table-cell-role="th" scope="col">PhoneService</th>
<th data-quarto-table-cell-role="th" scope="col">MultipleLines</th>
<th data-quarto-table-cell-role="th" scope="col">InternetService</th>
<th data-quarto-table-cell-role="th" scope="col">...</th>
<th data-quarto-table-cell-role="th" scope="col">StreamingMovies</th>
<th data-quarto-table-cell-role="th" scope="col">Contract</th>
<th data-quarto-table-cell-role="th" scope="col">PaperlessBilling</th>
<th data-quarto-table-cell-role="th" scope="col">PaymentMethod</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyCharges</th>
<th data-quarto-table-cell-role="th" scope="col">TotalCharges</th>
<th data-quarto-table-cell-role="th" scope="col">Churn</th>
<th data-quarto-table-cell-role="th" scope="col">TotalChargesNorm</th>
<th data-quarto-table-cell-role="th" scope="col">TotalChargesStand</th>
<th data-quarto-table-cell-role="th" scope="col">TotalChargesScaled</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">...</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>6754</td>
<td>2775-SEFEE</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>DSL</td>
<td>...</td>
<td>No</td>
<td>Two year</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>61.9</td>
<td>0</td>
<td>No</td>
<td>0</td>
<td>-1.00882</td>
<td>-1.00882</td>
</tr>
<tr class="even">
<td>1340</td>
<td>1371-DWPAZ</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>No</td>
<td>No phone service</td>
<td>DSL</td>
<td>...</td>
<td>No</td>
<td>Two year</td>
<td>No</td>
<td>Credit card (automatic)</td>
<td>56.05</td>
<td>0</td>
<td>No</td>
<td>0</td>
<td>-1.00882</td>
<td>-1.00882</td>
</tr>
<tr class="odd">
<td>3826</td>
<td>3213-VVOLG</td>
<td>Male</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>...</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Mailed check</td>
<td>25.35</td>
<td>0</td>
<td>No</td>
<td>0</td>
<td>-1.00882</td>
<td>-1.00882</td>
</tr>
<tr class="even">
<td>5218</td>
<td>2923-ARZLG</td>
<td>Male</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>...</td>
<td>No internet service</td>
<td>One year</td>
<td>Yes</td>
<td>Mailed check</td>
<td>19.7</td>
<td>0</td>
<td>No</td>
<td>0</td>
<td>-1.00882</td>
<td>-1.00882</td>
</tr>
<tr class="odd">
<td>3331</td>
<td>7644-OMVMY</td>
<td>Male</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>...</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Mailed check</td>
<td>19.85</td>
<td>0</td>
<td>No</td>
<td>0</td>
<td>-1.00882</td>
<td>-1.00882</td>
</tr>
<tr class="even">
<td>936</td>
<td>5709-LVOEQ</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>...</td>
<td>Yes</td>
<td>Two year</td>
<td>No</td>
<td>Mailed check</td>
<td>80.85</td>
<td>0</td>
<td>No</td>
<td>0</td>
<td>-1.00882</td>
<td>-1.00882</td>
</tr>
<tr class="odd">
<td>753</td>
<td>3115-CZMZD</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>...</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Mailed check</td>
<td>20.25</td>
<td>0</td>
<td>No</td>
<td>0</td>
<td>-1.00882</td>
<td>-1.00882</td>
</tr>
<tr class="even">
<td>4380</td>
<td>2520-SGTTA</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>...</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Mailed check</td>
<td>20.0</td>
<td>0</td>
<td>No</td>
<td>0</td>
<td>-1.00882</td>
<td>-1.00882</td>
</tr>
<tr class="odd">
<td>488</td>
<td>4472-LVYGI</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>No</td>
<td>No phone service</td>
<td>DSL</td>
<td>...</td>
<td>No</td>
<td>Two year</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>52.55</td>
<td>0</td>
<td>No</td>
<td>0</td>
<td>-1.00882</td>
<td>-1.00882</td>
</tr>
<tr class="even">
<td>1082</td>
<td>4367-NUYAO</td>
<td>Male</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>...</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Mailed check</td>
<td>25.75</td>
<td>0</td>
<td>No</td>
<td>0</td>
<td>-1.00882</td>
<td>-1.00882</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr>
</section>
</section>
<section id="feature-transformation" class="level2" data-number="25.3">
<h2 data-number="25.3" class="anchored" data-anchor-id="feature-transformation"><span class="header-section-number">25.3</span> Feature Transformation</h2>
<p><code>Feature transformation</code> involves manipulating a predictor variable in some way so as to improve its performance in the predictive model. A variety of considerations come into play when transforming models, including:</p>
<ul class="task-list">
<li><label><input type="checkbox" checked="">The <code>flexibility</code> of machine learning and statistical models in dealing with different types of data. For example, some techniques require that the input data be in numeric format, whereas others can deal with other formats, such as categorical, text, or dates.</label></li>
<li><label><input type="checkbox" checked=""><code>Ease of interpretation</code>. A predictive model where all the predictors are on the same scale (e.g., have a mean of 0 and a standard deviation of 1), can make interpretation easier.</label></li>
<li><label><input type="checkbox" checked=""><code>Predictive accuracy</code>. Some transformations of variables can improve the accuracy of prediction (e.g., rather than including a numeric variable as a predictor, instead include both it and a second variable that is its square).</label></li>
<li><label><input type="checkbox" checked=""><code>Theory</code>. For example, economic theory dictates that in many situations the natural logarithm of data representing prices and quantities should be used.</label></li>
<li><label><input type="checkbox" checked=""><code>Computational error</code>. Many algorithms are written in such a way that “large” numbers cause them to give the wrong result, where “large” may not be so large (e.g., more than 10 or less than -10).</label></li>
</ul>
<section id="scaling-based-on-calculations" class="level3" data-number="25.3.1">
<h3 data-number="25.3.1" class="anchored" data-anchor-id="scaling-based-on-calculations"><span class="header-section-number">25.3.1</span> Scaling based on calculations</h3>
<p>Sometimes for changing data distribution before using in modeling or change correlation between input and output variables scientist changes data type with standart mathematical functions. Lets try transform <code>TotalCharges</code> with logarithm, sqrt and power up 2.</p>
<div id="96188d63" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb33-2"><a href="#cb33-2"></a>churn_data_tmp <span class="ot">&lt;-</span> churn_data <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3"></a>        <span class="fu">mutate</span>(<span class="at">TotalChargesLog =</span> <span class="fu">log</span>(TotalCharges),</span>
<span id="cb33-4"><a href="#cb33-4"></a>              <span class="at">TotalChargesSqrt =</span> <span class="fu">sqrt</span>(TotalCharges),</span>
<span id="cb33-5"><a href="#cb33-5"></a>              <span class="at">TotalChargesPow2 =</span> TotalCharges<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb33-6"><a href="#cb33-6"></a></span>
<span id="cb33-7"><a href="#cb33-7"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(churn_data_tmp, <span class="fu">aes</span>(<span class="at">x=</span>TotalChargesLog)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">15</span>)</span>
<span id="cb33-8"><a href="#cb33-8"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(churn_data_tmp, <span class="fu">aes</span>(<span class="at">x=</span>TotalChargesSqrt)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">15</span>)</span>
<span id="cb33-9"><a href="#cb33-9"></a>plot3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(churn_data_tmp, <span class="fu">aes</span>(<span class="at">x=</span>TotalChargesPow2)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">15</span>)</span>
<span id="cb33-10"><a href="#cb33-10"></a><span class="fu">grid.arrange</span>(plot1, plot2, plot3, <span class="at">ncol=</span><span class="dv">3</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etl-feature-engineering_files/figure-html/cell-26-output-1.png" width="420" height="420" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Lets try</p>
<div id="4468151d-41b3-4f1e-8d48-9847c7e7b9eb" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co">#install.packages("moments")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>package 'moments' successfully unpacked and MD5 sums checked

The downloaded binary packages are in
    D:\Temp\Rtmpum9OKD\downloaded_packages</code></pre>
</div>
</div>
<div id="c880dcde" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="fu">library</span>(moments)</span>
<span id="cb36-2"><a href="#cb36-2"></a></span>
<span id="cb36-3"><a href="#cb36-3"></a><span class="fu">skewness</span>(churn_data_tmp<span class="sc">$</span>TotalCharges)</span>
<span id="cb36-4"><a href="#cb36-4"></a><span class="fu">skewness</span>(churn_data_tmp<span class="sc">$</span>TotalChargesLog)</span>
<span id="cb36-5"><a href="#cb36-5"></a><span class="fu">skewness</span>(churn_data_tmp<span class="sc">$</span>TotalChargesSqrt)</span>
<span id="cb36-6"><a href="#cb36-6"></a><span class="fu">skewness</span>(churn_data_tmp<span class="sc">$</span>TotalChargesPow2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
0.949325175892764
</div>
<div class="cell-output cell-output-display">
-0.75144252264496
</div>
<div class="cell-output cell-output-display">
0.302580803403444
</div>
<div class="cell-output cell-output-display">
1.80376407354267
</div>
</div>
<p><strong>Conclusion:</strong> different scaling gives different data distribution and may improve model perfomance if you have found the correct form of dependence of input/ouput parameters.</p>
<hr>
</section>
</section>
<section id="feature-construction" class="level2" data-number="25.4">
<h2 data-number="25.4" class="anchored" data-anchor-id="feature-construction"><span class="header-section-number">25.4</span> Feature Construction</h2>
<p>The <strong><code>feature Construction</code></strong> method helps in creating new features in the data thereby increasing model accuracy and overall predictions. It is of two types:</p>
<ul class="task-list">
<li><label><input type="checkbox" checked=""><code>Binning</code>: Bins are created for continuous variables.</label></li>
<li><label><input type="checkbox" checked=""><code>Encoding</code>: Numerical variables or features are formed from categorical variables.</label></li>
</ul>
<p>Додано мною, бо не знайшов ніде такого прийому) Всі одразу моделюють)) - [x] <code>Evaluation</code> - construction new features on raw data from datasource.</p>
<section id="binning" class="level3" data-number="25.4.1">
<h3 data-number="25.4.1" class="anchored" data-anchor-id="binning"><span class="header-section-number">25.4.1</span> Binning</h3>
<p><code>Binning</code> is done to create bins for continuous variables where they are converted to categorical variables.</p>
<p><code>Binning</code> is the term used in scoring modeling for what is also known in Machine Learning as <code>Discretization</code>, the process of transforming a continuous characteristic into a finite number of intervals (the bins), which allows for a better understanding of its distribution and its relationship with a binary variable. The bins generated by the this process will eventually become the attributes of a predictive characteristic, the key component of a Scorecard.</p>
<p>Why Binning?</p>
<ul class="task-list">
<li><label><input type="checkbox" checked="">It allows missing data and other special calculations (e.g.&nbsp;divided by zero) to be included in the model.</label></li>
<li><label><input type="checkbox" checked="">It controls or mitigates the impact of outliers over the model.</label></li>
<li><label><input type="checkbox" checked="">It solves the issue of having different scales among the characteristics, making the weights of the coefficients in the final model comparable.</label></li>
</ul>
<p>There are two types of binning: <code>Unsupervised</code> and <code>Supervised</code>.</p>
<p><code>Unsupervised Binning</code> involves Automatic and Manual binning. In Automatic Binning, bins are created without human interference and are created automatically. In Manual Binning, bins are created with human interference and we specify where the bins to be created.</p>
<p><code>Supervised Binning</code> involves creating bins for the continuous variable while taking the target variable into the consideration also. <code>Supervised Discretization or Binning</code> divides a continuous feature into groups (bins) mapped to a target variable. The central idea is to find those cutpoints that maximize the difference between the groups.</p>
<p>In the past, analysts used to iteratively move from Fine Binning to Coarse Binning, a very time consuming process of finding manually and visually the right cutpoints (if ever). Nowadays with algorithms like ChiMerge or Recursive Partitioning, two out of several techniques available, analysts can quickly find the optimal cutpoints in seconds and evaluate the relationship with the target variable using metrics such as Weight of Evidence and Information Value.</p>
<p>There are many packages for creating new variables: <code>smbinning</code>, <code>scorecard</code>, <code>rbin</code>, <code>InformationValue</code> and other.</p>
<section id="woe-binning-theory" class="level4" data-number="25.4.1.1">
<h4 data-number="25.4.1.1" class="anchored" data-anchor-id="woe-binning-theory"><span class="header-section-number">25.4.1.1</span> WOE binning: theory</h4>
<p><strong><code>Weight of evidence (WOE)</code></strong></p>
<p>This is basically a technique that can be applied if we have a binary response variable and any kind of predictor variable. First we perform a reasonable binning on the response variable and then decide which form of the binary response we count as positive and which as negative. Then we calculate the percentage positive cases in each bin of the total of all positive cases. For example 20 positive cases in bin A out of 100 total positive cases in all bins equals 20 %. Next we calculate the percentage of negative cases in each bin of the total of all negative cases, for example 5 negative cases in bin A out of a total of 50 negative cases in all bins equals 10%. Then we calculate the WOE by dividing the bin percentages of positive cases by the bin percentage of negative cases, and take the logarithm. For the described example log(20/10).</p>
<p>Rule of thump: If WOE values are negative, negative cases supersede the positive cases. If WOE values are positive, positive cases supersede the negative cases.</p>
<p>This serves the following purposes:</p>
<ul>
<li>We eliminate any none-linear relationships</li>
<li>We automatically scale all variables too some extend</li>
<li>We convert categorical variables to contineous variables</li>
<li>Missing Data can be handled as just another factor value</li>
<li>We can built a stand alone score card, that could be manually applied by a person with a pen and a printout of all relevant variables.</li>
</ul>
<p>It has the following disadvantages:</p>
<ul>
<li>We always loose information via binning</li>
<li>Score development along single variables is not contineous and occurs in steps</li>
<li>Binning requires manual revision</li>
<li>Calculating Variable importance is not as straight forward as with classical logistic regression with regularly scaled variables</li>
</ul>
<p><strong><code>Information Value (IV)</code></strong></p>
<p>By doing another sequence of calculations similar to the WOE calculation we can calculate the <code>IV</code>. Classically this serves as variable ranking method and allows us to perform feature selection, which is less compuationally demanding as other methods.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Information Value</th>
<th>Predictive Power</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>&lt; 0.02</td>
<td>useless for prediction</td>
</tr>
<tr class="even">
<td>0.02 - 0.1</td>
<td>weak predictor</td>
</tr>
<tr class="odd">
<td>0.1 - 0.3</td>
<td>medium predictor</td>
</tr>
<tr class="even">
<td>0.3 - 0.5</td>
<td>strong predictor</td>
</tr>
<tr class="odd">
<td>&gt; 0.5</td>
<td>suspicious too good to be true</td>
</tr>
</tbody>
</table>
<p>After calculating WOE value it replaces the original values in dataset.</p>
</section>
<section id="scorecard-package-and-woebin-function" class="level4" data-number="25.4.1.2">
<h4 data-number="25.4.1.2" class="anchored" data-anchor-id="scorecard-package-and-woebin-function"><span class="header-section-number">25.4.1.2</span> <code>scorecard</code> package and <code>woebin()</code>-function</h4>
<p><code>woebin</code> generates optimal binning for numerical, factor and categorical variables using methods including tree-like segmentation or chi-square merge. woebin can also customizing breakpoints if the breaks_list was provided. The default woe is defined as ln(Pos_i/Neg_i). If you prefer ln(Neg_i/Pos_i), please set the argument positive as negative value, such as ‘0’ or ‘good’. If there is a zero frequency class when calculating woe, the zero will replaced by 0.99 to make the woe calculable.</p>
<div id="a8e5517e" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="co"># lets try to bin InternetService, TotalCharges from churn_data_tmp</span></span>
<span id="cb37-2"><a href="#cb37-2"></a>churn_data_tmp <span class="ot">&lt;-</span> churn_data <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3"></a>        <span class="fu">mutate</span>(<span class="at">Churn =</span> <span class="fu">ifelse</span>(Churn <span class="sc">==</span> <span class="st">"Yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb37-4"><a href="#cb37-4"></a></span>
<span id="cb37-5"><a href="#cb37-5"></a>bin_data <span class="ot">&lt;-</span> churn_data_tmp <span class="sc">%&gt;%</span> <span class="fu">select</span>(customerID, InternetService, TotalCharges, Churn)</span>
<span id="cb37-6"><a href="#cb37-6"></a><span class="fu">head</span>(bin_data)</span>
<span id="cb37-7"><a href="#cb37-7"></a></span>
<span id="cb37-8"><a href="#cb37-8"></a><span class="co">#churn_data_tmp%&gt;%select(Churn) %&gt;% distinct()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 6 × 4</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">customerID</th>
<th data-quarto-table-cell-role="th" scope="col">InternetService</th>
<th data-quarto-table-cell-role="th" scope="col">TotalCharges</th>
<th data-quarto-table-cell-role="th" scope="col">Churn</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">1</td>
<td>7010-BRBUU</td>
<td>No</td>
<td>1734.65</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">2</td>
<td>9688-YGXVR</td>
<td>Fiber optic</td>
<td>3973.20</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">3</td>
<td>9286-DOJGF</td>
<td>Fiber optic</td>
<td>2869.85</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">4</td>
<td>6994-KERXL</td>
<td>DSL</td>
<td>238.50</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">5</td>
<td>2181-UAESM</td>
<td>DSL</td>
<td>119.50</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">6</td>
<td>4312-GVYNH</td>
<td>DSL</td>
<td>3370.20</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="0388db77" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="co"># install.packages("scorecard")</span></span>
<span id="cb38-2"><a href="#cb38-2"></a><span class="fu">library</span>(scorecard)</span>
<span id="cb38-3"><a href="#cb38-3"></a></span>
<span id="cb38-4"><a href="#cb38-4"></a>bins <span class="ot">=</span> <span class="fu">woebin</span>(bin_data, <span class="co"># dataset</span></span>
<span id="cb38-5"><a href="#cb38-5"></a>              <span class="at">y =</span> <span class="st">'Churn'</span>, <span class="co"># target variable</span></span>
<span id="cb38-6"><a href="#cb38-6"></a>              <span class="at">x =</span> <span class="fu">c</span>(<span class="st">"InternetService"</span>, <span class="st">"TotalCharges"</span>)) <span class="co"># variables for binning</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[INFO] creating woe binning ... </code></pre>
</div>
</div>
<div id="12e72af8" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="co"># lets view our bins</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>bins</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<dl>
    <dt>$InternetService</dt>
        <dd>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.table: 3 × 12</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">variable</th>
<th data-quarto-table-cell-role="th" scope="col">bin</th>
<th data-quarto-table-cell-role="th" scope="col">count</th>
<th data-quarto-table-cell-role="th" scope="col">count_distr</th>
<th data-quarto-table-cell-role="th" scope="col">neg</th>
<th data-quarto-table-cell-role="th" scope="col">pos</th>
<th data-quarto-table-cell-role="th" scope="col">posprob</th>
<th data-quarto-table-cell-role="th" scope="col">woe</th>
<th data-quarto-table-cell-role="th" scope="col">bin_iv</th>
<th data-quarto-table-cell-role="th" scope="col">total_iv</th>
<th data-quarto-table-cell-role="th" scope="col">breaks</th>
<th data-quarto-table-cell-role="th" scope="col">is_special_values</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;lgl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>InternetService</td>
<td>No</td>
<td>1291</td>
<td>0.2156699</td>
<td>1192</td>
<td>99</td>
<td>0.07668474</td>
<td>-1.4687362</td>
<td>0.30636195</td>
<td>0.5897126</td>
<td>No</td>
<td>FALSE</td>
</tr>
<tr class="even">
<td>InternetService</td>
<td>DSL</td>
<td>2068</td>
<td>0.3454728</td>
<td>1671</td>
<td>397</td>
<td>0.19197292</td>
<td>-0.4177094</td>
<td>0.05417755</td>
<td>0.5897126</td>
<td>DSL</td>
<td>FALSE</td>
</tr>
<tr class="odd">
<td>InternetService</td>
<td>Fiber optic</td>
<td>2627</td>
<td>0.4388573</td>
<td>1536</td>
<td>1091</td>
<td>0.41530263</td>
<td>0.6774449</td>
<td>0.22917306</td>
<td>0.5897126</td>
<td>Fiber optic</td>
<td>FALSE</td>
</tr>
</tbody>
</table>

</dd>
    <dt>$TotalCharges</dt>
        <dd>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.table: 4 × 12</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">variable</th>
<th data-quarto-table-cell-role="th" scope="col">bin</th>
<th data-quarto-table-cell-role="th" scope="col">count</th>
<th data-quarto-table-cell-role="th" scope="col">count_distr</th>
<th data-quarto-table-cell-role="th" scope="col">neg</th>
<th data-quarto-table-cell-role="th" scope="col">pos</th>
<th data-quarto-table-cell-role="th" scope="col">posprob</th>
<th data-quarto-table-cell-role="th" scope="col">woe</th>
<th data-quarto-table-cell-role="th" scope="col">bin_iv</th>
<th data-quarto-table-cell-role="th" scope="col">total_iv</th>
<th data-quarto-table-cell-role="th" scope="col">breaks</th>
<th data-quarto-table-cell-role="th" scope="col">is_special_values</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;lgl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>TotalCharges</td>
<td>[-Inf,200)</td>
<td>1004</td>
<td>0.16772469</td>
<td>517</td>
<td>487</td>
<td>0.4850598</td>
<td>0.9597530</td>
<td>0.181721173</td>
<td>0.3097399</td>
<td>200</td>
<td>FALSE</td>
</tr>
<tr class="even">
<td>TotalCharges</td>
<td>[200,400)</td>
<td>488</td>
<td>0.08152355</td>
<td>327</td>
<td>161</td>
<td>0.3299180</td>
<td>0.3109760</td>
<td>0.008431865</td>
<td>0.3097399</td>
<td>400</td>
<td>FALSE</td>
</tr>
<tr class="odd">
<td>TotalCharges</td>
<td>[400,3800)</td>
<td>2981</td>
<td>0.49799532</td>
<td>2266</td>
<td>715</td>
<td>0.2398524</td>
<td>-0.1339571</td>
<td>0.008651146</td>
<td>0.3097399</td>
<td>3800</td>
<td>FALSE</td>
</tr>
<tr class="even">
<td>TotalCharges</td>
<td>[3800, Inf)</td>
<td>1513</td>
<td>0.25275643</td>
<td>1289</td>
<td>224</td>
<td>0.1480502</td>
<td>-0.7304442</td>
<td>0.110935711</td>
<td>0.3097399</td>
<td>Inf</td>
<td>FALSE</td>
</tr>
</tbody>
</table>

</dd>
</dl>
</div>
</div>
<div id="1532a309" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>churn_data_tmp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(TotalCharges <span class="sc">&gt;</span> <span class="dv">3800</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Churn) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Churn) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 2 × 2</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">Churn</th>
<th data-quarto-table-cell-role="th" scope="col">n()</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>1289</td>
</tr>
<tr class="even">
<td>1</td>
<td>224</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="1db580e1" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>bins<span class="sc">$</span>TotalCharges <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>() <span class="co"># better view for RStudio, need knitr to be installed</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>

|variable     |bin         | count| count_distr|  neg| pos|   posprob|        woe|    bin_iv|  total_iv|breaks |is_special_values |
|:------------|:-----------|-----:|-----------:|----:|---:|---------:|----------:|---------:|---------:|:------|:-----------------|
|TotalCharges |[-Inf,200)  |  1004|   0.1677247|  517| 487| 0.4850598|  0.9597530| 0.1817212| 0.3097399|200    |FALSE             |
|TotalCharges |[200,400)   |   488|   0.0815236|  327| 161| 0.3299180|  0.3109760| 0.0084319| 0.3097399|400    |FALSE             |
|TotalCharges |[400,3800)  |  2981|   0.4979953| 2266| 715| 0.2398524| -0.1339571| 0.0086511| 0.3097399|3800   |FALSE             |
|TotalCharges |[3800, Inf) |  1513|   0.2527564| 1289| 224| 0.1480502| -0.7304442| 0.1109357| 0.3097399|Inf    |FALSE             |</code></pre>
</div>
</div>
<div id="3617ef20" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="co"># preview the plot</span></span>
<span id="cb44-2"><a href="#cb44-2"></a><span class="fu">woebin_plot</span>(bins<span class="sc">$</span>TotalCharges)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>$TotalCharges</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etl-feature-engineering_files/figure-html/cell-34-output-2.png" width="420" height="420" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>If TotalCharges less than 200 its most risky group of customers, 48.5% of them are potential churn.</p>
<div id="a70b92d8" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>bins<span class="sc">$</span>InternetService <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>() </span>
<span id="cb46-2"><a href="#cb46-2"></a><span class="fu">woebin_plot</span>(bins<span class="sc">$</span>InternetService)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>

|variable        |bin         | count| count_distr|  neg|  pos|   posprob|        woe|    bin_iv|  total_iv|breaks      |is_special_values |
|:---------------|:-----------|-----:|-----------:|----:|----:|---------:|----------:|---------:|---------:|:-----------|:-----------------|
|InternetService |No          |  1291|   0.2156699| 1192|   99| 0.0766847| -1.4687362| 0.3063620| 0.5897126|No          |FALSE             |
|InternetService |DSL         |  2068|   0.3454728| 1671|  397| 0.1919729| -0.4177094| 0.0541776| 0.5897126|DSL         |FALSE             |
|InternetService |Fiber optic |  2627|   0.4388573| 1536| 1091| 0.4153026|  0.6774449| 0.2291731| 0.5897126|Fiber optic |FALSE             |</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>$InternetService</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etl-feature-engineering_files/figure-html/cell-35-output-3.png" width="420" height="420" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Fiber optic InternetService customers are the most risky. 41.5% of them are potentiona churn.</p>
<p>The next stage is applying bins to th the variables:</p>
<div id="3b7bd7a9" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a>bin_data_woe <span class="ot">=</span> <span class="fu">woebin_ply</span>(bin_data, bins) </span>
<span id="cb49-2"><a href="#cb49-2"></a><span class="fu">head</span>(bin_data)</span>
<span id="cb49-3"><a href="#cb49-3"></a><span class="fu">head</span>(bin_data_woe) <span class="co"># compare how it changed</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[INFO] converting into woe values ... </code></pre>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 6 × 4</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">customerID</th>
<th data-quarto-table-cell-role="th" scope="col">InternetService</th>
<th data-quarto-table-cell-role="th" scope="col">TotalCharges</th>
<th data-quarto-table-cell-role="th" scope="col">Churn</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">1</td>
<td>7010-BRBUU</td>
<td>No</td>
<td>1734.65</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">2</td>
<td>9688-YGXVR</td>
<td>Fiber optic</td>
<td>3973.20</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">3</td>
<td>9286-DOJGF</td>
<td>Fiber optic</td>
<td>2869.85</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">4</td>
<td>6994-KERXL</td>
<td>DSL</td>
<td>238.50</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">5</td>
<td>2181-UAESM</td>
<td>DSL</td>
<td>119.50</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">6</td>
<td>4312-GVYNH</td>
<td>DSL</td>
<td>3370.20</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.table: 6 × 4</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">customerID</th>
<th data-quarto-table-cell-role="th" scope="col">Churn</th>
<th data-quarto-table-cell-role="th" scope="col">InternetService_woe</th>
<th data-quarto-table-cell-role="th" scope="col">TotalCharges_woe</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>7010-BRBUU</td>
<td>0</td>
<td>-1.4687362</td>
<td>-0.1339571</td>
</tr>
<tr class="even">
<td>9688-YGXVR</td>
<td>0</td>
<td>0.6774449</td>
<td>-0.7304442</td>
</tr>
<tr class="odd">
<td>9286-DOJGF</td>
<td>1</td>
<td>0.6774449</td>
<td>-0.1339571</td>
</tr>
<tr class="even">
<td>6994-KERXL</td>
<td>0</td>
<td>-0.4177094</td>
<td>0.3109760</td>
</tr>
<tr class="odd">
<td>2181-UAESM</td>
<td>0</td>
<td>-0.4177094</td>
<td>0.9597530</td>
</tr>
<tr class="even">
<td>4312-GVYNH</td>
<td>0</td>
<td>-0.4177094</td>
<td>-0.1339571</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="63ad605e" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>bins<span class="sc">$</span>InternetService <span class="co">#No is replaced by WOE -1.4687362 (line 1)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.table: 3 × 12</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">variable</th>
<th data-quarto-table-cell-role="th" scope="col">bin</th>
<th data-quarto-table-cell-role="th" scope="col">count</th>
<th data-quarto-table-cell-role="th" scope="col">count_distr</th>
<th data-quarto-table-cell-role="th" scope="col">neg</th>
<th data-quarto-table-cell-role="th" scope="col">pos</th>
<th data-quarto-table-cell-role="th" scope="col">posprob</th>
<th data-quarto-table-cell-role="th" scope="col">woe</th>
<th data-quarto-table-cell-role="th" scope="col">bin_iv</th>
<th data-quarto-table-cell-role="th" scope="col">total_iv</th>
<th data-quarto-table-cell-role="th" scope="col">breaks</th>
<th data-quarto-table-cell-role="th" scope="col">is_special_values</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;lgl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>InternetService</td>
<td>No</td>
<td>1291</td>
<td>0.2156699</td>
<td>1192</td>
<td>99</td>
<td>0.07668474</td>
<td>-1.4687362</td>
<td>0.30636195</td>
<td>0.5897126</td>
<td>No</td>
<td>FALSE</td>
</tr>
<tr class="even">
<td>InternetService</td>
<td>DSL</td>
<td>2068</td>
<td>0.3454728</td>
<td>1671</td>
<td>397</td>
<td>0.19197292</td>
<td>-0.4177094</td>
<td>0.05417755</td>
<td>0.5897126</td>
<td>DSL</td>
<td>FALSE</td>
</tr>
<tr class="odd">
<td>InternetService</td>
<td>Fiber optic</td>
<td>2627</td>
<td>0.4388573</td>
<td>1536</td>
<td>1091</td>
<td>0.41530263</td>
<td>0.6774449</td>
<td>0.22917306</td>
<td>0.5897126</td>
<td>Fiber optic</td>
<td>FALSE</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>So, both numerical and categorical variables are binned by woebin function.</p>
<p>In real-life project you should dou binning with the next steps:</p>
<ol type="1">
<li>Clean data</li>
<li>Split data into train/test (+prediction)</li>
<li>Create bins on train set (and save them if your model not one-time used)</li>
<li>Apply bins to all sets you have</li>
</ol>
<p>Lest see how to make it with our dataset <code>churn_data</code>.</p>
<div id="abd3addf" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb52-2"><a href="#cb52-2"></a><span class="fu">library</span>(gmodels)</span>
<span id="cb52-3"><a href="#cb52-3"></a><span class="fu">set.seed</span>(<span class="dv">2021</span>) <span class="co"># to fix split options</span></span>
<span id="cb52-4"><a href="#cb52-4"></a></span>
<span id="cb52-5"><a href="#cb52-5"></a>churn_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../../data/telecom_users.csv"</span>) <span class="co"># read data</span></span>
<span id="cb52-6"><a href="#cb52-6"></a>churn_data <span class="ot">&lt;-</span> churn_data <span class="sc">%&gt;%</span> </span>
<span id="cb52-7"><a href="#cb52-7"></a>    <span class="fu">select</span>(customerID, gender, PaymentMethod, TotalCharges, Churn) <span class="sc">%&gt;%</span> <span class="co"># select some columns for test + target</span></span>
<span id="cb52-8"><a href="#cb52-8"></a>    <span class="fu">mutate</span>(<span class="at">Churn =</span> <span class="fu">ifelse</span>(Churn <span class="sc">==</span> <span class="st">"Yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="co"># replace Churn Yes/No with 1/0 - Event/NonEvent</span></span>
<span id="cb52-9"><a href="#cb52-9"></a><span class="fu">head</span>(churn_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 6 × 5</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">customerID</th>
<th data-quarto-table-cell-role="th" scope="col">gender</th>
<th data-quarto-table-cell-role="th" scope="col">PaymentMethod</th>
<th data-quarto-table-cell-role="th" scope="col">TotalCharges</th>
<th data-quarto-table-cell-role="th" scope="col">Churn</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">1</td>
<td>7010-BRBUU</td>
<td>Male</td>
<td>Credit card (automatic)</td>
<td>1734.65</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">2</td>
<td>9688-YGXVR</td>
<td>Female</td>
<td>Credit card (automatic)</td>
<td>3973.20</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">3</td>
<td>9286-DOJGF</td>
<td>Female</td>
<td>Bank transfer (automatic)</td>
<td>2869.85</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">4</td>
<td>6994-KERXL</td>
<td>Male</td>
<td>Electronic check</td>
<td>238.50</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">5</td>
<td>2181-UAESM</td>
<td>Male</td>
<td>Electronic check</td>
<td>119.50</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">6</td>
<td>4312-GVYNH</td>
<td>Female</td>
<td>Bank transfer (automatic)</td>
<td>3370.20</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="a55ab256" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>index <span class="ot">=</span> <span class="fu">createDataPartition</span>(churn_data<span class="sc">$</span>Churn, <span class="at">p =</span> <span class="fl">0.60</span>, <span class="at">list =</span> <span class="cn">FALSE</span>) <span class="co"># select randomly indexes of the rows for train</span></span>
<span id="cb53-2"><a href="#cb53-2"></a>train <span class="ot">=</span> churn_data[index, ]</span>
<span id="cb53-3"><a href="#cb53-3"></a>test <span class="ot">=</span> churn_data[<span class="sc">-</span>index, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="4e9f3755" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a>data_bins <span class="ot">=</span> <span class="fu">woebin</span>(train, <span class="co"># dataset</span></span>
<span id="cb54-2"><a href="#cb54-2"></a>                   <span class="at">y =</span> <span class="st">"Churn"</span>, <span class="co"># target</span></span>
<span id="cb54-3"><a href="#cb54-3"></a>                   <span class="at">var_skip =</span> <span class="st">"customerID"</span> <span class="co"># skip ID</span></span>
<span id="cb54-4"><a href="#cb54-4"></a>                  <span class="co"># x = c("gender", "PaymentMethod", "TotalCharges") # select some varables</span></span>
<span id="cb54-5"><a href="#cb54-5"></a>                   <span class="co">#var_skip = "customerID" # target variable - not working in jupyter</span></span>
<span id="cb54-6"><a href="#cb54-6"></a>             )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[INFO] creating woe binning ... </code></pre>
</div>
</div>
<div id="18fcf89d" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a>data_bins</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<dl>
    <dt>$gender</dt>
        <dd>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.table: 2 × 12</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">variable</th>
<th data-quarto-table-cell-role="th" scope="col">bin</th>
<th data-quarto-table-cell-role="th" scope="col">count</th>
<th data-quarto-table-cell-role="th" scope="col">count_distr</th>
<th data-quarto-table-cell-role="th" scope="col">neg</th>
<th data-quarto-table-cell-role="th" scope="col">pos</th>
<th data-quarto-table-cell-role="th" scope="col">posprob</th>
<th data-quarto-table-cell-role="th" scope="col">woe</th>
<th data-quarto-table-cell-role="th" scope="col">bin_iv</th>
<th data-quarto-table-cell-role="th" scope="col">total_iv</th>
<th data-quarto-table-cell-role="th" scope="col">breaks</th>
<th data-quarto-table-cell-role="th" scope="col">is_special_values</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;lgl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>gender</td>
<td>Female</td>
<td>1770</td>
<td>0.4927617</td>
<td>1314</td>
<td>456</td>
<td>0.2576271</td>
<td>-0.02546718</td>
<td>0.0003176558</td>
<td>0.0006226087</td>
<td>Female</td>
<td>FALSE</td>
</tr>
<tr class="even">
<td>gender</td>
<td>Male</td>
<td>1822</td>
<td>0.5072383</td>
<td>1335</td>
<td>487</td>
<td>0.2672887</td>
<td>0.02444876</td>
<td>0.0003049529</td>
<td>0.0006226087</td>
<td>Male</td>
<td>FALSE</td>
</tr>
</tbody>
</table>

</dd>
    <dt>$PaymentMethod</dt>
        <dd>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.table: 3 × 12</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">variable</th>
<th data-quarto-table-cell-role="th" scope="col">bin</th>
<th data-quarto-table-cell-role="th" scope="col">count</th>
<th data-quarto-table-cell-role="th" scope="col">count_distr</th>
<th data-quarto-table-cell-role="th" scope="col">neg</th>
<th data-quarto-table-cell-role="th" scope="col">pos</th>
<th data-quarto-table-cell-role="th" scope="col">posprob</th>
<th data-quarto-table-cell-role="th" scope="col">woe</th>
<th data-quarto-table-cell-role="th" scope="col">bin_iv</th>
<th data-quarto-table-cell-role="th" scope="col">total_iv</th>
<th data-quarto-table-cell-role="th" scope="col">breaks</th>
<th data-quarto-table-cell-role="th" scope="col">is_special_values</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;lgl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>PaymentMethod</td>
<td>Credit card (automatic)%,%Bank transfer (automatic)</td>
<td>1562</td>
<td>0.4348552</td>
<td>1312</td>
<td>250</td>
<td>0.1600512</td>
<td>-0.6249758</td>
<td>0.14385062</td>
<td>0.4324699</td>
<td>Credit card (automatic)%,%Bank transfer (automatic)</td>
<td>FALSE</td>
</tr>
<tr class="even">
<td>PaymentMethod</td>
<td>Mailed check</td>
<td>822</td>
<td>0.2288419</td>
<td>665</td>
<td>157</td>
<td>0.1909976</td>
<td>-0.4106700</td>
<td>0.03472141</td>
<td>0.4324699</td>
<td>Mailed check</td>
<td>FALSE</td>
</tr>
<tr class="odd">
<td>PaymentMethod</td>
<td>Electronic check</td>
<td>1208</td>
<td>0.3363029</td>
<td>672</td>
<td>536</td>
<td>0.4437086</td>
<td>0.8067470</td>
<td>0.25389789</td>
<td>0.4324699</td>
<td>Electronic check</td>
<td>FALSE</td>
</tr>
</tbody>
</table>

</dd>
    <dt>$TotalCharges</dt>
        <dd>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.table: 5 × 12</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">variable</th>
<th data-quarto-table-cell-role="th" scope="col">bin</th>
<th data-quarto-table-cell-role="th" scope="col">count</th>
<th data-quarto-table-cell-role="th" scope="col">count_distr</th>
<th data-quarto-table-cell-role="th" scope="col">neg</th>
<th data-quarto-table-cell-role="th" scope="col">pos</th>
<th data-quarto-table-cell-role="th" scope="col">posprob</th>
<th data-quarto-table-cell-role="th" scope="col">woe</th>
<th data-quarto-table-cell-role="th" scope="col">bin_iv</th>
<th data-quarto-table-cell-role="th" scope="col">total_iv</th>
<th data-quarto-table-cell-role="th" scope="col">breaks</th>
<th data-quarto-table-cell-role="th" scope="col">is_special_values</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;lgl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>TotalCharges</td>
<td>missing</td>
<td>6</td>
<td>0.001670379</td>
<td>6</td>
<td>0</td>
<td>0.00000000</td>
<td>-0.7699879</td>
<td>0.0009365099</td>
<td>0.3222676</td>
<td>missing</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>TotalCharges</td>
<td>[-Inf,400)</td>
<td>893</td>
<td>0.248608018</td>
<td>505</td>
<td>388</td>
<td>0.43449048</td>
<td>0.7682688</td>
<td>0.1693136398</td>
<td>0.3222676</td>
<td>400</td>
<td>FALSE</td>
</tr>
<tr class="odd">
<td>TotalCharges</td>
<td>[400,3200)</td>
<td>1601</td>
<td>0.445712695</td>
<td>1207</td>
<td>394</td>
<td>0.24609619</td>
<td>-0.0877204</td>
<td>0.0033567382</td>
<td>0.3222676</td>
<td>3200</td>
<td>FALSE</td>
</tr>
<tr class="even">
<td>TotalCharges</td>
<td>[3200,6600)</td>
<td>850</td>
<td>0.236636971</td>
<td>711</td>
<td>139</td>
<td>0.16352941</td>
<td>-0.6003766</td>
<td>0.0727391340</td>
<td>0.3222676</td>
<td>6600</td>
<td>FALSE</td>
</tr>
<tr class="odd">
<td>TotalCharges</td>
<td>[6600, Inf)</td>
<td>242</td>
<td>0.067371938</td>
<td>220</td>
<td>22</td>
<td>0.09090909</td>
<td>-1.2707632</td>
<td>0.0759215884</td>
<td>0.3222676</td>
<td>Inf</td>
<td>FALSE</td>
</tr>
</tbody>
</table>

</dd>
</dl>
</div>
</div>
<div id="9c7134b0" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>train_woe <span class="ot">=</span> <span class="fu">woebin_ply</span>(train, data_bins) </span>
<span id="cb57-2"><a href="#cb57-2"></a><span class="fu">head</span>(train_woe)</span>
<span id="cb57-3"><a href="#cb57-3"></a>test_woe <span class="ot">=</span> <span class="fu">woebin_ply</span>(test, data_bins) </span>
<span id="cb57-4"><a href="#cb57-4"></a><span class="fu">head</span>(test_woe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[INFO] converting into woe values ... </code></pre>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.table: 6 × 5</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">customerID</th>
<th data-quarto-table-cell-role="th" scope="col">Churn</th>
<th data-quarto-table-cell-role="th" scope="col">gender_woe</th>
<th data-quarto-table-cell-role="th" scope="col">PaymentMethod_woe</th>
<th data-quarto-table-cell-role="th" scope="col">TotalCharges_woe</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>7010-BRBUU</td>
<td>0</td>
<td>0.02444876</td>
<td>-0.6249758</td>
<td>-0.0877204</td>
</tr>
<tr class="even">
<td>4367-NHWMM</td>
<td>0</td>
<td>-0.02546718</td>
<td>-0.4106700</td>
<td>0.7682688</td>
</tr>
<tr class="odd">
<td>8016-NCFVO</td>
<td>0</td>
<td>0.02444876</td>
<td>0.8067470</td>
<td>-0.6003766</td>
</tr>
<tr class="even">
<td>4578-PHJYZ</td>
<td>0</td>
<td>0.02444876</td>
<td>0.8067470</td>
<td>-0.6003766</td>
</tr>
<tr class="odd">
<td>2091-MJTFX</td>
<td>1</td>
<td>-0.02546718</td>
<td>-0.6249758</td>
<td>-0.0877204</td>
</tr>
<tr class="even">
<td>2277-DJJDL</td>
<td>0</td>
<td>0.02444876</td>
<td>0.8067470</td>
<td>-0.6003766</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[INFO] converting into woe values ... </code></pre>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.table: 6 × 5</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">customerID</th>
<th data-quarto-table-cell-role="th" scope="col">Churn</th>
<th data-quarto-table-cell-role="th" scope="col">gender_woe</th>
<th data-quarto-table-cell-role="th" scope="col">PaymentMethod_woe</th>
<th data-quarto-table-cell-role="th" scope="col">TotalCharges_woe</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>9688-YGXVR</td>
<td>0</td>
<td>-0.02546718</td>
<td>-0.6249758</td>
<td>-0.6003766</td>
</tr>
<tr class="even">
<td>9286-DOJGF</td>
<td>1</td>
<td>-0.02546718</td>
<td>-0.6249758</td>
<td>-0.0877204</td>
</tr>
<tr class="odd">
<td>6994-KERXL</td>
<td>0</td>
<td>0.02444876</td>
<td>0.8067470</td>
<td>0.7682688</td>
</tr>
<tr class="even">
<td>2181-UAESM</td>
<td>0</td>
<td>0.02444876</td>
<td>0.8067470</td>
<td>0.7682688</td>
</tr>
<tr class="odd">
<td>4312-GVYNH</td>
<td>0</td>
<td>-0.02546718</td>
<td>-0.6249758</td>
<td>-0.6003766</td>
</tr>
<tr class="even">
<td>2495-KZNFB</td>
<td>0</td>
<td>-0.02546718</td>
<td>0.8067470</td>
<td>-0.0877204</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>For now our data is ready for modeling.</p>
<hr>
</section>
<section id="encoding" class="level4" data-number="25.4.1.3">
<h4 data-number="25.4.1.3" class="anchored" data-anchor-id="encoding"><span class="header-section-number">25.4.1.3</span> Encoding</h4>
<p><code>Encoding</code> is the process in which numerical variables or features are created from <code>categorical</code> variables. It is a widely used method in the industry and in every model building process. It is of two types: <code>Label Encoding</code> and <code>One-hot Encoding</code>.</p>
<p><code>Label Encoding</code> involves assigning each label a unique integer or value based on alphabetical ordering. It is the most popular and widely used encoding.</p>
<p><code>One-hot Encoding</code> involves creating additional features or variables on the basis of unique values in categorical variables i.e.&nbsp;every unique value in the category will be added as a new feature.</p>
<section id="label-encoding" class="level5" data-number="25.4.1.3.1">
<h5 data-number="25.4.1.3.1" class="anchored" data-anchor-id="label-encoding"><span class="header-section-number">25.4.1.3.1</span> Label encoding</h5>
<div id="8641d577" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a><span class="co"># Lets use client churn dataset from telco: https://www.kaggle.com/blastchar/telco-customer-churn</span></span>
<span id="cb60-2"><a href="#cb60-2"></a>churn_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/telecom_users.csv"</span>)</span>
<span id="cb60-3"><a href="#cb60-3"></a><span class="fu">head</span>(churn_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 6 × 22</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">X</th>
<th data-quarto-table-cell-role="th" scope="col">customerID</th>
<th data-quarto-table-cell-role="th" scope="col">gender</th>
<th data-quarto-table-cell-role="th" scope="col">SeniorCitizen</th>
<th data-quarto-table-cell-role="th" scope="col">Partner</th>
<th data-quarto-table-cell-role="th" scope="col">Dependents</th>
<th data-quarto-table-cell-role="th" scope="col">tenure</th>
<th data-quarto-table-cell-role="th" scope="col">PhoneService</th>
<th data-quarto-table-cell-role="th" scope="col">MultipleLines</th>
<th data-quarto-table-cell-role="th" scope="col">InternetService</th>
<th data-quarto-table-cell-role="th" scope="col">⋯</th>
<th data-quarto-table-cell-role="th" scope="col">DeviceProtection</th>
<th data-quarto-table-cell-role="th" scope="col">TechSupport</th>
<th data-quarto-table-cell-role="th" scope="col">StreamingTV</th>
<th data-quarto-table-cell-role="th" scope="col">StreamingMovies</th>
<th data-quarto-table-cell-role="th" scope="col">Contract</th>
<th data-quarto-table-cell-role="th" scope="col">PaperlessBilling</th>
<th data-quarto-table-cell-role="th" scope="col">PaymentMethod</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyCharges</th>
<th data-quarto-table-cell-role="th" scope="col">TotalCharges</th>
<th data-quarto-table-cell-role="th" scope="col">Churn</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">⋯</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">1</td>
<td>1869</td>
<td>7010-BRBUU</td>
<td>Male</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>72</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>⋯</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Credit card (automatic)</td>
<td>24.1</td>
<td>1734.65</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">2</td>
<td>4528</td>
<td>9688-YGXVR</td>
<td>Female</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>44</td>
<td>Yes</td>
<td>No</td>
<td>Fiber optic</td>
<td>⋯</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Credit card (automatic)</td>
<td>88.15</td>
<td>3973.20</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">3</td>
<td>6344</td>
<td>9286-DOJGF</td>
<td>Female</td>
<td>1</td>
<td>Yes</td>
<td>No</td>
<td>38</td>
<td>Yes</td>
<td>Yes</td>
<td>Fiber optic</td>
<td>⋯</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>74.95</td>
<td>2869.85</td>
<td>Yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">4</td>
<td>6739</td>
<td>6994-KERXL</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>4</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>⋯</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>55.9</td>
<td>238.50</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">5</td>
<td>432</td>
<td>2181-UAESM</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>2</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>⋯</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>No</td>
<td>Electronic check</td>
<td>53.45</td>
<td>119.50</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">6</td>
<td>2215</td>
<td>4312-GVYNH</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>70</td>
<td>No</td>
<td>No phone service</td>
<td>DSL</td>
<td>⋯</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td>Two year</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>49.85</td>
<td>3370.20</td>
<td>No</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr>
</section>
<section id="encoding-with-factors" class="level5" data-number="25.4.1.3.2">
<h5 data-number="25.4.1.3.2" class="anchored" data-anchor-id="encoding-with-factors"><span class="header-section-number">25.4.1.3.2</span> Encoding with factors</h5>
<p>Its good way to encode labels as factors in R. This approach used for categorical data encoding. Easiest way is convert character values to factor and later convert factor to numeric:</p>
<div id="4c2e7f27" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a>churn_data <span class="ot">&lt;-</span> churn_data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Partner =</span> <span class="fu">as.factor</span>(Partner),</span>
<span id="cb61-2"><a href="#cb61-2"></a>                                   <span class="at">Dependents =</span> <span class="fu">as.factor</span>(Dependents))</span>
<span id="cb61-3"><a href="#cb61-3"></a><span class="fu">head</span>(churn_data) <span class="co"># data types changed for selected fields</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 6 × 22</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">X</th>
<th data-quarto-table-cell-role="th" scope="col">customerID</th>
<th data-quarto-table-cell-role="th" scope="col">gender</th>
<th data-quarto-table-cell-role="th" scope="col">SeniorCitizen</th>
<th data-quarto-table-cell-role="th" scope="col">Partner</th>
<th data-quarto-table-cell-role="th" scope="col">Dependents</th>
<th data-quarto-table-cell-role="th" scope="col">tenure</th>
<th data-quarto-table-cell-role="th" scope="col">PhoneService</th>
<th data-quarto-table-cell-role="th" scope="col">MultipleLines</th>
<th data-quarto-table-cell-role="th" scope="col">InternetService</th>
<th data-quarto-table-cell-role="th" scope="col">⋯</th>
<th data-quarto-table-cell-role="th" scope="col">DeviceProtection</th>
<th data-quarto-table-cell-role="th" scope="col">TechSupport</th>
<th data-quarto-table-cell-role="th" scope="col">StreamingTV</th>
<th data-quarto-table-cell-role="th" scope="col">StreamingMovies</th>
<th data-quarto-table-cell-role="th" scope="col">Contract</th>
<th data-quarto-table-cell-role="th" scope="col">PaperlessBilling</th>
<th data-quarto-table-cell-role="th" scope="col">PaymentMethod</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyCharges</th>
<th data-quarto-table-cell-role="th" scope="col">TotalCharges</th>
<th data-quarto-table-cell-role="th" scope="col">Churn</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;fct&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;fct&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">⋯</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">1</td>
<td>1869</td>
<td>7010-BRBUU</td>
<td>Male</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>72</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>⋯</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Credit card (automatic)</td>
<td>24.1</td>
<td>1734.65</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">2</td>
<td>4528</td>
<td>9688-YGXVR</td>
<td>Female</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>44</td>
<td>Yes</td>
<td>No</td>
<td>Fiber optic</td>
<td>⋯</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Credit card (automatic)</td>
<td>88.15</td>
<td>3973.20</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">3</td>
<td>6344</td>
<td>9286-DOJGF</td>
<td>Female</td>
<td>1</td>
<td>Yes</td>
<td>No</td>
<td>38</td>
<td>Yes</td>
<td>Yes</td>
<td>Fiber optic</td>
<td>⋯</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>74.95</td>
<td>2869.85</td>
<td>Yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">4</td>
<td>6739</td>
<td>6994-KERXL</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>4</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>⋯</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>55.9</td>
<td>238.50</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">5</td>
<td>432</td>
<td>2181-UAESM</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>2</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>⋯</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>No</td>
<td>Electronic check</td>
<td>53.45</td>
<td>119.50</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">6</td>
<td>2215</td>
<td>4312-GVYNH</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>70</td>
<td>No</td>
<td>No phone service</td>
<td>DSL</td>
<td>⋯</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td>Two year</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>49.85</td>
<td>3370.20</td>
<td>No</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="6f525b1c" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="fu">str</span>(churn_data<span class="sc">$</span>Partner) <span class="co"># check levels</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Factor w/ 2 levels "No","Yes": 2 1 2 1 1 2 1 1 1 1 ...</code></pre>
</div>
</div>
<div id="df68ec1e" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="co"># convert to integers</span></span>
<span id="cb64-2"><a href="#cb64-2"></a>churn_data <span class="ot">&lt;-</span> churn_data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Partner =</span> <span class="fu">as.integer</span>(Partner),</span>
<span id="cb64-3"><a href="#cb64-3"></a>                                   <span class="at">Dependents =</span> <span class="fu">as.integer</span>(Dependents))</span>
<span id="cb64-4"><a href="#cb64-4"></a><span class="fu">head</span>(churn_data) <span class="co"># data types changed for selected fields</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 6 × 22</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">X</th>
<th data-quarto-table-cell-role="th" scope="col">customerID</th>
<th data-quarto-table-cell-role="th" scope="col">gender</th>
<th data-quarto-table-cell-role="th" scope="col">SeniorCitizen</th>
<th data-quarto-table-cell-role="th" scope="col">Partner</th>
<th data-quarto-table-cell-role="th" scope="col">Dependents</th>
<th data-quarto-table-cell-role="th" scope="col">tenure</th>
<th data-quarto-table-cell-role="th" scope="col">PhoneService</th>
<th data-quarto-table-cell-role="th" scope="col">MultipleLines</th>
<th data-quarto-table-cell-role="th" scope="col">InternetService</th>
<th data-quarto-table-cell-role="th" scope="col">⋯</th>
<th data-quarto-table-cell-role="th" scope="col">DeviceProtection</th>
<th data-quarto-table-cell-role="th" scope="col">TechSupport</th>
<th data-quarto-table-cell-role="th" scope="col">StreamingTV</th>
<th data-quarto-table-cell-role="th" scope="col">StreamingMovies</th>
<th data-quarto-table-cell-role="th" scope="col">Contract</th>
<th data-quarto-table-cell-role="th" scope="col">PaperlessBilling</th>
<th data-quarto-table-cell-role="th" scope="col">PaymentMethod</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyCharges</th>
<th data-quarto-table-cell-role="th" scope="col">TotalCharges</th>
<th data-quarto-table-cell-role="th" scope="col">Churn</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">⋯</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">1</td>
<td>1869</td>
<td>7010-BRBUU</td>
<td>Male</td>
<td>0</td>
<td>2</td>
<td>2</td>
<td>72</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>⋯</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Credit card (automatic)</td>
<td>24.1</td>
<td>1734.65</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">2</td>
<td>4528</td>
<td>9688-YGXVR</td>
<td>Female</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>44</td>
<td>Yes</td>
<td>No</td>
<td>Fiber optic</td>
<td>⋯</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Credit card (automatic)</td>
<td>88.15</td>
<td>3973.20</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">3</td>
<td>6344</td>
<td>9286-DOJGF</td>
<td>Female</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>38</td>
<td>Yes</td>
<td>Yes</td>
<td>Fiber optic</td>
<td>⋯</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>74.95</td>
<td>2869.85</td>
<td>Yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">4</td>
<td>6739</td>
<td>6994-KERXL</td>
<td>Male</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>4</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>⋯</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>55.9</td>
<td>238.50</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">5</td>
<td>432</td>
<td>2181-UAESM</td>
<td>Male</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>⋯</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>No</td>
<td>Electronic check</td>
<td>53.45</td>
<td>119.50</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">6</td>
<td>2215</td>
<td>4312-GVYNH</td>
<td>Female</td>
<td>0</td>
<td>2</td>
<td>1</td>
<td>70</td>
<td>No</td>
<td>No phone service</td>
<td>DSL</td>
<td>⋯</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td>Two year</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>49.85</td>
<td>3370.20</td>
<td>No</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>But you should check factor to numbers converting to synchronize train/test/prediction correct numbering. In this case you should save somewhere levels of factor. Better way is to use encoders with fitting.</p>
<hr>
</section>
<section id="encoding-with-labelencoder-from-superml-package" class="level5" data-number="25.4.1.3.3">
<h5 data-number="25.4.1.3.3" class="anchored" data-anchor-id="encoding-with-labelencoder-from-superml-package"><span class="header-section-number">25.4.1.3.3</span> Encoding with LabelEncoder from <code>superml</code> package</h5>
<div id="6a94c0ad" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a><span class="co"># install.packages("superml") #you olso need R6 package</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>also installing the dependency 'BH'

</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>package 'BH' successfully unpacked and MD5 sums checked
package 'superml' successfully unpacked and MD5 sums checked

The downloaded binary packages are in
    D:\Temp\Rtmpum9OKD\downloaded_packages</code></pre>
</div>
</div>
<div id="3d6be2fa" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a><span class="fu">library</span>(superml)</span>
<span id="cb68-2"><a href="#cb68-2"></a></span>
<span id="cb68-3"><a href="#cb68-3"></a>label <span class="ot">&lt;-</span> LabelEncoder<span class="sc">$</span><span class="fu">new</span>() <span class="co"># create new encoder</span></span>
<span id="cb68-4"><a href="#cb68-4"></a><span class="fu">print</span>(label<span class="sc">$</span><span class="fu">fit</span>(churn_data<span class="sc">$</span>InternetService)) <span class="co"># fir the encoder</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: R6
</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<div id="9d617bc4" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a><span class="co"># encode data</span></span>
<span id="cb71-2"><a href="#cb71-2"></a>churn_data<span class="sc">$</span>InternetService <span class="ot">&lt;-</span> label<span class="sc">$</span><span class="fu">fit_transform</span>(churn_data<span class="sc">$</span>InternetService) </span>
<span id="cb71-3"><a href="#cb71-3"></a><span class="co"># do not re-run it, because InternetService ineteger for now</span></span>
<span id="cb71-4"><a href="#cb71-4"></a><span class="fu">head</span>(churn_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 6 × 22</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">X</th>
<th data-quarto-table-cell-role="th" scope="col">customerID</th>
<th data-quarto-table-cell-role="th" scope="col">gender</th>
<th data-quarto-table-cell-role="th" scope="col">SeniorCitizen</th>
<th data-quarto-table-cell-role="th" scope="col">Partner</th>
<th data-quarto-table-cell-role="th" scope="col">Dependents</th>
<th data-quarto-table-cell-role="th" scope="col">tenure</th>
<th data-quarto-table-cell-role="th" scope="col">PhoneService</th>
<th data-quarto-table-cell-role="th" scope="col">MultipleLines</th>
<th data-quarto-table-cell-role="th" scope="col">InternetService</th>
<th data-quarto-table-cell-role="th" scope="col">...</th>
<th data-quarto-table-cell-role="th" scope="col">DeviceProtection</th>
<th data-quarto-table-cell-role="th" scope="col">TechSupport</th>
<th data-quarto-table-cell-role="th" scope="col">StreamingTV</th>
<th data-quarto-table-cell-role="th" scope="col">StreamingMovies</th>
<th data-quarto-table-cell-role="th" scope="col">Contract</th>
<th data-quarto-table-cell-role="th" scope="col">PaperlessBilling</th>
<th data-quarto-table-cell-role="th" scope="col">PaymentMethod</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyCharges</th>
<th data-quarto-table-cell-role="th" scope="col">TotalCharges</th>
<th data-quarto-table-cell-role="th" scope="col">Churn</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">...</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">1</td>
<td>1869</td>
<td>7010-BRBUU</td>
<td>Male</td>
<td>0</td>
<td>2</td>
<td>2</td>
<td>72</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>...</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Credit card (automatic)</td>
<td>24.1</td>
<td>1734.65</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">2</td>
<td>4528</td>
<td>9688-YGXVR</td>
<td>Female</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>44</td>
<td>Yes</td>
<td>No</td>
<td>1</td>
<td>...</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Credit card (automatic)</td>
<td>88.15</td>
<td>3973.20</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">3</td>
<td>6344</td>
<td>9286-DOJGF</td>
<td>Female</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>38</td>
<td>Yes</td>
<td>Yes</td>
<td>1</td>
<td>...</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>74.95</td>
<td>2869.85</td>
<td>Yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">4</td>
<td>6739</td>
<td>6994-KERXL</td>
<td>Male</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>4</td>
<td>Yes</td>
<td>No</td>
<td>2</td>
<td>...</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>55.9</td>
<td>238.50</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">5</td>
<td>432</td>
<td>2181-UAESM</td>
<td>Male</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>Yes</td>
<td>No</td>
<td>2</td>
<td>...</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>No</td>
<td>Electronic check</td>
<td>53.45</td>
<td>119.50</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">6</td>
<td>2215</td>
<td>4312-GVYNH</td>
<td>Female</td>
<td>0</td>
<td>2</td>
<td>1</td>
<td>70</td>
<td>No</td>
<td>No phone service</td>
<td>2</td>
<td>...</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td>Two year</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>49.85</td>
<td>3370.20</td>
<td>No</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Now you can save your encoding configuration and use it for test/prediction sets later.</p>
<hr>
</section>
</section>
<section id="one-hot-encoding" class="level4" data-number="25.4.1.4">
<h4 data-number="25.4.1.4" class="anchored" data-anchor-id="one-hot-encoding"><span class="header-section-number">25.4.1.4</span> One-hot encoding</h4>
<div id="58276eba" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a><span class="co"># Lets use client churn dataset from telco: https://www.kaggle.com/blastchar/telco-customer-churn</span></span>
<span id="cb72-2"><a href="#cb72-2"></a>churn_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/telecom_users.csv"</span>)</span>
<span id="cb72-3"><a href="#cb72-3"></a><span class="fu">head</span>(churn_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 6 × 22</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">X</th>
<th data-quarto-table-cell-role="th" scope="col">customerID</th>
<th data-quarto-table-cell-role="th" scope="col">gender</th>
<th data-quarto-table-cell-role="th" scope="col">SeniorCitizen</th>
<th data-quarto-table-cell-role="th" scope="col">Partner</th>
<th data-quarto-table-cell-role="th" scope="col">Dependents</th>
<th data-quarto-table-cell-role="th" scope="col">tenure</th>
<th data-quarto-table-cell-role="th" scope="col">PhoneService</th>
<th data-quarto-table-cell-role="th" scope="col">MultipleLines</th>
<th data-quarto-table-cell-role="th" scope="col">InternetService</th>
<th data-quarto-table-cell-role="th" scope="col">⋯</th>
<th data-quarto-table-cell-role="th" scope="col">DeviceProtection</th>
<th data-quarto-table-cell-role="th" scope="col">TechSupport</th>
<th data-quarto-table-cell-role="th" scope="col">StreamingTV</th>
<th data-quarto-table-cell-role="th" scope="col">StreamingMovies</th>
<th data-quarto-table-cell-role="th" scope="col">Contract</th>
<th data-quarto-table-cell-role="th" scope="col">PaperlessBilling</th>
<th data-quarto-table-cell-role="th" scope="col">PaymentMethod</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyCharges</th>
<th data-quarto-table-cell-role="th" scope="col">TotalCharges</th>
<th data-quarto-table-cell-role="th" scope="col">Churn</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">⋯</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">1</td>
<td>1869</td>
<td>7010-BRBUU</td>
<td>Male</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>72</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>⋯</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Credit card (automatic)</td>
<td>24.1</td>
<td>1734.65</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">2</td>
<td>4528</td>
<td>9688-YGXVR</td>
<td>Female</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>44</td>
<td>Yes</td>
<td>No</td>
<td>Fiber optic</td>
<td>⋯</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Credit card (automatic)</td>
<td>88.15</td>
<td>3973.20</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">3</td>
<td>6344</td>
<td>9286-DOJGF</td>
<td>Female</td>
<td>1</td>
<td>Yes</td>
<td>No</td>
<td>38</td>
<td>Yes</td>
<td>Yes</td>
<td>Fiber optic</td>
<td>⋯</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>74.95</td>
<td>2869.85</td>
<td>Yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">4</td>
<td>6739</td>
<td>6994-KERXL</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>4</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>⋯</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>55.9</td>
<td>238.50</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">5</td>
<td>432</td>
<td>2181-UAESM</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>2</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>⋯</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>No</td>
<td>Electronic check</td>
<td>53.45</td>
<td>119.50</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">6</td>
<td>2215</td>
<td>4312-GVYNH</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>70</td>
<td>No</td>
<td>No phone service</td>
<td>DSL</td>
<td>⋯</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td>Two year</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>49.85</td>
<td>3370.20</td>
<td>No</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="81d2387d" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a><span class="co"># check possible Gender values</span></span>
<span id="cb73-2"><a href="#cb73-2"></a>gmodels<span class="sc">::</span><span class="fu">CrossTable</span>(churn_data<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 
   Cell Contents
|-------------------------|
|                       N |
|         N / Table Total |
|-------------------------|

 
Total Observations in Table:  5986 

 
          |    Female |      Male | 
          |-----------|-----------|
          |      2936 |      3050 | 
          |     0.490 |     0.510 | 
          |-----------|-----------|



 </code></pre>
</div>
</div>
<p>Lets create two additional variables <code>Male</code> and <code>Female</code> encoded by 1 / 0:</p>
<ul class="task-list">
<li><label><input type="checkbox" checked="">Create a Male column that encodes each row corresponding to male as 1 and set everything else to 0.</label></li>
<li><label><input type="checkbox" checked="">Create a Female column that encodes each row corresponding to female as 1 and set everything else to 0.</label></li>
</ul>
<div id="cd5a96df" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a><span class="co"># if gender is factor</span></span>
<span id="cb75-2"><a href="#cb75-2"></a><span class="co">#churn_data &lt;- churn_data %&gt;% </span></span>
<span id="cb75-3"><a href="#cb75-3"></a>   <span class="co">#     mutate(gender = as.character(gender)) # convert Gender to character from Factor</span></span>
<span id="cb75-4"><a href="#cb75-4"></a></span>
<span id="cb75-5"><a href="#cb75-5"></a>churn_data <span class="ot">&lt;-</span> churn_data <span class="sc">%&gt;%</span> </span>
<span id="cb75-6"><a href="#cb75-6"></a>        <span class="fu">mutate</span>(</span>
<span id="cb75-7"><a href="#cb75-7"></a>            <span class="co"># create Male column</span></span>
<span id="cb75-8"><a href="#cb75-8"></a>            <span class="at">Male =</span> <span class="fu">ifelse</span>(gender <span class="sc">==</span> <span class="st">"Male"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb75-9"><a href="#cb75-9"></a>            <span class="co"># create Female column</span></span>
<span id="cb75-10"><a href="#cb75-10"></a>            <span class="at">Female =</span> <span class="fu">ifelse</span>(gender <span class="sc">==</span> <span class="st">"Female"</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb75-11"><a href="#cb75-11"></a></span>
<span id="cb75-12"><a href="#cb75-12"></a>churn_data <span class="sc">|&gt;</span> <span class="fu">select</span>(gender, Male, Female) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 6 × 3</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">gender</th>
<th data-quarto-table-cell-role="th" scope="col">Male</th>
<th data-quarto-table-cell-role="th" scope="col">Female</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">1</td>
<td>Male</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">2</td>
<td>Female</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">3</td>
<td>Female</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">4</td>
<td>Male</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">5</td>
<td>Male</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">6</td>
<td>Female</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Lets create a dummy variables for <code>InternetService</code> column. So, what data it has for now?</p>
<div id="0e416fd9" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a>gmodels<span class="sc">::</span><span class="fu">CrossTable</span>(churn_data<span class="sc">$</span>InternetService)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 
   Cell Contents
|-------------------------|
|                       N |
|         N / Table Total |
|-------------------------|

 
Total Observations in Table:  5986 

 
            |         DSL | Fiber optic |          No | 
            |-------------|-------------|-------------|
            |        2068 |        2627 |        1291 | 
            |       0.345 |       0.439 |       0.216 | 
            |-------------|-------------|-------------|



 </code></pre>
</div>
</div>
<p>The function <code>dummyVars()</code> from <code>caret</code> package can be used to generate a complete (less than full rank parameterized) set of dummy variables from one or more factors. The function takes a formula and a data set and outputs an object that can be used to create the dummy variables using the predict method.</p>
<div id="76d99796" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb78-2"><a href="#cb78-2"></a></span>
<span id="cb78-3"><a href="#cb78-3"></a>churn_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/telecom_users.csv"</span>)</span>
<span id="cb78-4"><a href="#cb78-4"></a></span>
<span id="cb78-5"><a href="#cb78-5"></a>dummy <span class="ot">&lt;-</span> <span class="fu">dummyVars</span>(<span class="st">" ~ InternetService"</span>, <span class="at">data =</span> churn_data)</span>
<span id="cb78-6"><a href="#cb78-6"></a>new_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">predict</span>(dummy, <span class="at">newdata =</span> churn_data)) <span class="co"># precit dummy variables and</span></span>
<span id="cb78-7"><a href="#cb78-7"></a>new_df <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 6 × 3</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">InternetServiceDSL</th>
<th data-quarto-table-cell-role="th" scope="col">InternetServiceFiber.optic</th>
<th data-quarto-table-cell-role="th" scope="col">InternetServiceNo</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">2</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">3</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">4</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">5</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">6</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>If you want create dummy variables for all categoriacal columns just use <code>" ~ ."</code> formula.</p>
<div id="f9e6bc05" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a>dummy <span class="ot">&lt;-</span> <span class="fu">dummyVars</span>(<span class="st">" ~ ."</span>, <span class="at">data =</span> churn_data)</span>
<span id="cb79-2"><a href="#cb79-2"></a>new_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">predict</span>(dummy, <span class="at">newdata =</span> churn_data)) <span class="co"># precit dummy variables and</span></span>
<span id="cb79-3"><a href="#cb79-3"></a>new_df <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 6 × 7560</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">X</th>
<th data-quarto-table-cell-role="th" scope="col">customerID0002.ORFBO</th>
<th data-quarto-table-cell-role="th" scope="col">customerID0003.MKNFE</th>
<th data-quarto-table-cell-role="th" scope="col">customerID0004.TLHLJ</th>
<th data-quarto-table-cell-role="th" scope="col">customerID0011.IGKFF</th>
<th data-quarto-table-cell-role="th" scope="col">customerID0013.EXCHZ</th>
<th data-quarto-table-cell-role="th" scope="col">customerID0013.MHZWF</th>
<th data-quarto-table-cell-role="th" scope="col">customerID0013.SMEOE</th>
<th data-quarto-table-cell-role="th" scope="col">customerID0014.BMAQU</th>
<th data-quarto-table-cell-role="th" scope="col">customerID0015.UOCOJ</th>
<th data-quarto-table-cell-role="th" scope="col">⋯</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyCharges99.7</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyCharges99.75</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyCharges99.8</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyCharges99.85</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyCharges99.9</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyCharges99.95</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyChargesNULL</th>
<th data-quarto-table-cell-role="th" scope="col">TotalCharges</th>
<th data-quarto-table-cell-role="th" scope="col">ChurnNo</th>
<th data-quarto-table-cell-role="th" scope="col">ChurnYes</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">⋯</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">1</td>
<td>1869</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>⋯</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1734.65</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">2</td>
<td>4528</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>⋯</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>3973.20</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">3</td>
<td>6344</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>⋯</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2869.85</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">4</td>
<td>6739</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>⋯</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>238.50</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">5</td>
<td>432</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>⋯</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>119.50</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">6</td>
<td>2215</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>⋯</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>3370.20</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>You can remove some variables, for example Churn, becouse its target variable</p>
<div id="88ebca57" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a>dummy <span class="ot">&lt;-</span> <span class="fu">dummyVars</span>(<span class="st">" ~. -Churn"</span>, <span class="at">data =</span> churn_data)</span>
<span id="cb80-2"><a href="#cb80-2"></a>new_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">predict</span>(dummy, <span class="at">newdata =</span> churn_data)) <span class="co"># precit dummy variables and</span></span>
<span id="cb80-3"><a href="#cb80-3"></a>new_df <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 6 × 7558</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">X</th>
<th data-quarto-table-cell-role="th" scope="col">customerID0002.ORFBO</th>
<th data-quarto-table-cell-role="th" scope="col">customerID0003.MKNFE</th>
<th data-quarto-table-cell-role="th" scope="col">customerID0004.TLHLJ</th>
<th data-quarto-table-cell-role="th" scope="col">customerID0011.IGKFF</th>
<th data-quarto-table-cell-role="th" scope="col">customerID0013.EXCHZ</th>
<th data-quarto-table-cell-role="th" scope="col">customerID0013.MHZWF</th>
<th data-quarto-table-cell-role="th" scope="col">customerID0013.SMEOE</th>
<th data-quarto-table-cell-role="th" scope="col">customerID0014.BMAQU</th>
<th data-quarto-table-cell-role="th" scope="col">customerID0015.UOCOJ</th>
<th data-quarto-table-cell-role="th" scope="col">...</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyCharges99.6</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyCharges99.65</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyCharges99.7</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyCharges99.75</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyCharges99.8</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyCharges99.85</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyCharges99.9</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyCharges99.95</th>
<th data-quarto-table-cell-role="th" scope="col">MonthlyChargesNULL</th>
<th data-quarto-table-cell-role="th" scope="col">TotalCharges</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">...</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">1</td>
<td>1869</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1734.65</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">2</td>
<td>4528</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>3973.20</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">3</td>
<td>6344</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2869.85</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">4</td>
<td>6739</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>238.50</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">5</td>
<td>432</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>119.50</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">6</td>
<td>2215</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>3370.20</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>If you need some few do this with + operator:</p>
<div id="d7e9bd7f" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a>dummy <span class="ot">&lt;-</span> <span class="fu">dummyVars</span>(<span class="st">" ~ InternetService + PhoneService"</span>, <span class="at">data =</span> churn_data)</span>
<span id="cb81-2"><a href="#cb81-2"></a>new_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">predict</span>(dummy, <span class="at">newdata =</span> churn_data)) <span class="co"># precit dummy variables and</span></span>
<span id="cb81-3"><a href="#cb81-3"></a>new_df <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 6 × 5</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">InternetServiceDSL</th>
<th data-quarto-table-cell-role="th" scope="col">InternetServiceFiber.optic</th>
<th data-quarto-table-cell-role="th" scope="col">InternetServiceNo</th>
<th data-quarto-table-cell-role="th" scope="col">PhoneServiceNo</th>
<th data-quarto-table-cell-role="th" scope="col">PhoneServiceYes</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">2</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">3</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">4</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">5</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">6</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="evaluate-data-on-raw-dataset" class="level3" data-number="25.4.2">
<h3 data-number="25.4.2" class="anchored" data-anchor-id="evaluate-data-on-raw-dataset"><span class="header-section-number">25.4.2</span> Evaluate data on raw dataset</h3>
<p>Previous data transformation approaches use prepared datasets. But sometimes you should create new variables from raw data than cannot be attached to you existing dataset and implemented as-is for modeling.</p>
<p>Lest check an example with customer transactions data.</p>
<div class="alert alert-info">
Preview data file in excel before read it to R!
</div>
<div id="6353d4ac" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a><span class="co"># read transaction data from dataset</span></span>
<span id="cb82-2"><a href="#cb82-2"></a><span class="co"># explore file in Excel before reading to check sheet numbers and tables structure</span></span>
<span id="cb82-3"><a href="#cb82-3"></a><span class="fu">library</span>(xlsx)</span>
<span id="cb82-4"><a href="#cb82-4"></a>demographics <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(<span class="st">"data/transactions.xlsx"</span>, <span class="at">sheetIndex =</span> <span class="dv">1</span>)</span>
<span id="cb82-5"><a href="#cb82-5"></a><span class="fu">head</span>(demographics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>java.home option: 

JAVA_HOME environment variable: C:\Program Files\Java\jdk-19\bin;C:\Program Files\Common Files\Oracle\Java\javapath\java.exe;C:\Program Files\Common Files\Oracle\Java\javapath\;

Warning message in fun(libname, pkgname):
"Java home setting is INVALID, it will be ignored.
Please do NOT set it unless you want to override system settings."</code></pre>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 4 × 4</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">CustomerID</th>
<th data-quarto-table-cell-role="th" scope="col">Gender</th>
<th data-quarto-table-cell-role="th" scope="col">Email</th>
<th data-quarto-table-cell-role="th" scope="col">VisitsLastYear</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">1</td>
<td>787987456</td>
<td>Male</td>
<td>Yes</td>
<td>12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">2</td>
<td>456415151</td>
<td>Male</td>
<td>NULL</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">3</td>
<td>215454555</td>
<td>Female</td>
<td>No</td>
<td>16</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">4</td>
<td>985121122</td>
<td>Female</td>
<td>No</td>
<td>4</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="47fc31a7" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a><span class="co"># read transactions</span></span>
<span id="cb84-2"><a href="#cb84-2"></a>transactions <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(<span class="st">"data/transactions.xlsx"</span>, <span class="at">sheetIndex =</span> <span class="dv">2</span>)</span>
<span id="cb84-3"><a href="#cb84-3"></a><span class="fu">head</span>(transactions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 6 × 7</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">CustomerID</th>
<th data-quarto-table-cell-role="th" scope="col">ContractID</th>
<th data-quarto-table-cell-role="th" scope="col">Date</th>
<th data-quarto-table-cell-role="th" scope="col">Time</th>
<th data-quarto-table-cell-role="th" scope="col">ContractorID</th>
<th data-quarto-table-cell-role="th" scope="col">UsdEquiv_sum</th>
<th data-quarto-table-cell-role="th" scope="col">Type</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;date&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">1</td>
<td>215454555</td>
<td>19065798</td>
<td>2019-03-15</td>
<td>114537</td>
<td>NULL</td>
<td>6293.7111</td>
<td>credet</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">2</td>
<td>215454555</td>
<td>19065798</td>
<td>2019-04-05</td>
<td>102525</td>
<td>NULL</td>
<td>914.9459</td>
<td>credet</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">3</td>
<td>215454555</td>
<td>19065798</td>
<td>2019-05-11</td>
<td>80833</td>
<td>NULL</td>
<td>-4655.9111</td>
<td>debet</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">4</td>
<td>215454555</td>
<td>19065798</td>
<td>2019-05-16</td>
<td>74606</td>
<td>NULL</td>
<td>-13900.6889</td>
<td>debet</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">5</td>
<td>215454555</td>
<td>19065798</td>
<td>2019-05-30</td>
<td>104506</td>
<td>NULL</td>
<td>2102.0570</td>
<td>credet</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">6</td>
<td>215454555</td>
<td>19065798</td>
<td>2019-08-23</td>
<td>122656</td>
<td>NULL</td>
<td>-16244.2333</td>
<td>debet</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Our nex task is to construct new features based on transactions history:</p>
<ul class="task-list">
<li><label><input type="checkbox" checked=""><code>Churn</code> - target parameter if client has more than 60 days absent transactions between 2021-04-30 and last transaction date.</label></li>
<li><label><input type="checkbox" checked=""><code>AverageContractSum3M_Credet</code> - average contract sum by credet last 3 month <code>before event Churn == 1/0</code></label></li>
<li><label><input type="checkbox" checked=""><code>AverageIncrease3M_Credet</code> - average sum increase from month to month, for last 3 month, by credet</label></li>
</ul>
<div id="e986f62d" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a><span class="co"># lets find a maximum transaction date for each client</span></span>
<span id="cb85-2"><a href="#cb85-2"></a><span class="fu">library</span>(tidyverse) <span class="co"># includes magrittr, dplyr</span></span>
<span id="cb85-3"><a href="#cb85-3"></a>max_dates <span class="ot">&lt;-</span> transactions <span class="sc">%&gt;%</span></span>
<span id="cb85-4"><a href="#cb85-4"></a>        <span class="fu">group_by</span>(CustomerID) <span class="sc">%&gt;%</span></span>
<span id="cb85-5"><a href="#cb85-5"></a>        <span class="fu">summarise</span>(<span class="at">MaxDate =</span> <span class="fu">max</span>(Date))</span>
<span id="cb85-6"><a href="#cb85-6"></a>max_dates</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>-- Attaching packages ------------------------------------------------------------------------------- tidyverse 1.3.2 --
v tibble  3.1.8     v purrr   0.3.5
v tidyr   1.2.1     v stringr 1.4.1
v readr   2.1.3     v forcats 0.5.2
-- Conflicts ---------------------------------------------------------------------------------- tidyverse_conflicts() --
x gridExtra::combine() masks dplyr::combine()
x dplyr::filter()      masks stats::filter()
x dplyr::lag()         masks stats::lag()
x purrr::lift()        masks caret::lift()</code></pre>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 4 × 2</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">CustomerID</th>
<th data-quarto-table-cell-role="th" scope="col">MaxDate</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;date&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>215454555</td>
<td>2021-04-30</td>
</tr>
<tr class="even">
<td>456415151</td>
<td>2021-01-22</td>
</tr>
<tr class="odd">
<td>787987456</td>
<td>2019-12-06</td>
</tr>
<tr class="even">
<td>985121122</td>
<td>2020-09-09</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="2d4d1f69" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a><span class="fu">library</span>(lubridate) <span class="co">#for datetime manipulation</span></span>
<span id="cb87-2"><a href="#cb87-2"></a>current_date <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="st">"2021-04-30"</span>)</span>
<span id="cb87-3"><a href="#cb87-3"></a>max_dates <span class="ot">&lt;-</span> max_dates <span class="sc">%&gt;%</span></span>
<span id="cb87-4"><a href="#cb87-4"></a>        <span class="fu">mutate</span>(<span class="at">DaysDiff =</span> <span class="fu">as.period</span>(current_date <span class="sc">-</span> MaxDate) <span class="sc">%&gt;%</span> <span class="fu">day</span>()) <span class="co"># find period and convert it to days</span></span>
<span id="cb87-5"><a href="#cb87-5"></a>max_dates</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'lubridate'


The following objects are masked from 'package:base':

    date, intersect, setdiff, union

</code></pre>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 4 × 3</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">CustomerID</th>
<th data-quarto-table-cell-role="th" scope="col">MaxDate</th>
<th data-quarto-table-cell-role="th" scope="col">DaysDiff</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;date&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>215454555</td>
<td>2021-04-30</td>
<td>0</td>
</tr>
<tr class="even">
<td>456415151</td>
<td>2021-01-22</td>
<td>98</td>
</tr>
<tr class="odd">
<td>787987456</td>
<td>2019-12-06</td>
<td>511</td>
</tr>
<tr class="even">
<td>985121122</td>
<td>2020-09-09</td>
<td>233</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="bca23590" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a><span class="co"># lests calculate Churn feature</span></span>
<span id="cb89-2"><a href="#cb89-2"></a>max_dates <span class="ot">&lt;-</span> max_dates <span class="sc">%&gt;%</span></span>
<span id="cb89-3"><a href="#cb89-3"></a>        <span class="fu">mutate</span>(<span class="at">Churn =</span> <span class="fu">ifelse</span>(DaysDiff <span class="sc">&gt;</span> <span class="dv">60</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb89-4"><a href="#cb89-4"></a>max_dates</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 4 × 4</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">CustomerID</th>
<th data-quarto-table-cell-role="th" scope="col">MaxDate</th>
<th data-quarto-table-cell-role="th" scope="col">DaysDiff</th>
<th data-quarto-table-cell-role="th" scope="col">Churn</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;date&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>215454555</td>
<td>2021-04-30</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>456415151</td>
<td>2021-01-22</td>
<td>98</td>
<td>1</td>
</tr>
<tr class="odd">
<td>787987456</td>
<td>2019-12-06</td>
<td>511</td>
<td>1</td>
</tr>
<tr class="even">
<td>985121122</td>
<td>2020-09-09</td>
<td>233</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>You can finally merge code into one query:</p>
<div id="408d7db3" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a>churn_eval <span class="ot">&lt;-</span> transactions <span class="sc">%&gt;%</span></span>
<span id="cb90-2"><a href="#cb90-2"></a>        <span class="fu">group_by</span>(CustomerID) <span class="sc">%&gt;%</span></span>
<span id="cb90-3"><a href="#cb90-3"></a>        <span class="fu">summarise</span>(<span class="at">MaxDate =</span> <span class="fu">max</span>(Date)) <span class="sc">%&gt;%</span></span>
<span id="cb90-4"><a href="#cb90-4"></a>        <span class="fu">mutate</span>(<span class="at">DaysDiff =</span> <span class="fu">as.period</span>(current_date <span class="sc">-</span> MaxDate) <span class="sc">%&gt;%</span> <span class="fu">day</span>(),</span>
<span id="cb90-5"><a href="#cb90-5"></a>               <span class="at">Churn =</span> <span class="fu">ifelse</span>(DaysDiff <span class="sc">&gt;</span> <span class="dv">60</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb90-6"><a href="#cb90-6"></a>        <span class="fu">select</span>(CustomerID, Churn) <span class="co"># Select only CustomerID and new feature / target</span></span>
<span id="cb90-7"><a href="#cb90-7"></a>churn_eval <span class="co"># we will merge it with demographics later</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 4 × 2</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">CustomerID</th>
<th data-quarto-table-cell-role="th" scope="col">Churn</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>215454555</td>
<td>0</td>
</tr>
<tr class="even">
<td>456415151</td>
<td>1</td>
</tr>
<tr class="odd">
<td>787987456</td>
<td>1</td>
</tr>
<tr class="even">
<td>985121122</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="task.-averagecontractsum3m_credet" class="level4" data-number="25.4.2.1">
<h4 data-number="25.4.2.1" class="anchored" data-anchor-id="task.-averagecontractsum3m_credet"><span class="header-section-number">25.4.2.1</span> Task. AverageContractSum3M_Credet</h4>
<p>TASK: calculate average sum of contract for each customer by credet for last 3 month before Churn/NotChurn event</p>
<p>For calculating this data wee should do this steps:</p>
<ol type="1">
<li>Find max transaction date</li>
<li>Find transaction date 3 month ago (max transaction date - 3 month)</li>
<li>Filter only records in range (-3 month, max_transaction)</li>
<li>Group data by contracts and find every contract sum</li>
<li>Group data by customers and find every customer average</li>
</ol>
<div id="1db50232" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a>avgContractSum3m <span class="ot">&lt;-</span> transactions <span class="sc">%&gt;%</span></span>
<span id="cb91-2"><a href="#cb91-2"></a>        <span class="fu">filter</span>(Type <span class="sc">==</span> <span class="st">"credet"</span>) <span class="sc">%&gt;%</span> <span class="co"># only credet</span></span>
<span id="cb91-3"><a href="#cb91-3"></a>        <span class="fu">group_by</span>(CustomerID) <span class="sc">%&gt;%</span> </span>
<span id="cb91-4"><a href="#cb91-4"></a>        <span class="fu">mutate</span>(<span class="at">MaxDate =</span> <span class="fu">max</span>(Date), <span class="co"># get max transaction date</span></span>
<span id="cb91-5"><a href="#cb91-5"></a>               <span class="at">Month3Date =</span> MaxDate <span class="sc">%m+%</span> <span class="fu">months</span>(<span class="sc">-</span><span class="dv">3</span>)) <span class="sc">%&gt;%</span> <span class="co"># get date 3 month before max transaction date</span></span>
<span id="cb91-6"><a href="#cb91-6"></a>       <span class="fu">filter</span>(Date <span class="sc">&gt;=</span> Month3Date) <span class="sc">%&gt;%</span> <span class="co"># only transaction more than 3 month age left</span></span>
<span id="cb91-7"><a href="#cb91-7"></a>       <span class="fu">group_by</span>(CustomerID, ContractID) <span class="sc">%&gt;%</span> <span class="co"># group by customer and contract</span></span>
<span id="cb91-8"><a href="#cb91-8"></a>       <span class="fu">summarize</span>(<span class="at">ContractSum =</span> <span class="fu">sum</span>(UsdEquiv_sum), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">%&gt;%</span> <span class="co"># find sum by each contract</span></span>
<span id="cb91-9"><a href="#cb91-9"></a>       <span class="fu">group_by</span>(CustomerID) <span class="sc">%&gt;%</span> <span class="co"># group by customer</span></span>
<span id="cb91-10"><a href="#cb91-10"></a>       <span class="fu">summarise</span>(<span class="at">AverageContractSum3M_Credet =</span> <span class="fu">mean</span>(ContractSum)) <span class="co"># find mean by each customer</span></span>
<span id="cb91-11"><a href="#cb91-11"></a></span>
<span id="cb91-12"><a href="#cb91-12"></a>avgContractSum3m</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 4 × 2</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">CustomerID</th>
<th data-quarto-table-cell-role="th" scope="col">AverageContractSum3M_Credet</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>215454555</td>
<td>45541.3335</td>
</tr>
<tr class="even">
<td>456415151</td>
<td>1271.5930</td>
</tr>
<tr class="odd">
<td>787987456</td>
<td>116.6667</td>
</tr>
<tr class="even">
<td>985121122</td>
<td>4444.4444</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="task.-find-last-3-average-credet-sum-increase" class="level4" data-number="25.4.2.2">
<h4 data-number="25.4.2.2" class="anchored" data-anchor-id="task.-find-last-3-average-credet-sum-increase"><span class="header-section-number">25.4.2.2</span> Task. Find last 3 average credet sum increase</h4>
<ol type="1">
<li>Get dates range for -1, -2, -3 monthes by credet:</li>
</ol>
<div id="94f13e37" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1"></a>monthByMonth <span class="ot">&lt;-</span> transactions <span class="sc">%&gt;%</span></span>
<span id="cb92-2"><a href="#cb92-2"></a>        <span class="fu">filter</span>(Type <span class="sc">==</span> <span class="st">"credet"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-3"><a href="#cb92-3"></a>        <span class="fu">select</span>(CustomerID, Date, UsdEquiv_sum) <span class="sc">%&gt;%</span></span>
<span id="cb92-4"><a href="#cb92-4"></a>        <span class="fu">group_by</span>(CustomerID) <span class="sc">%&gt;%</span></span>
<span id="cb92-5"><a href="#cb92-5"></a>        <span class="fu">mutate</span>(<span class="at">MaxDate =</span> <span class="fu">max</span>(Date),</span>
<span id="cb92-6"><a href="#cb92-6"></a>               <span class="at">Month1Before =</span> MaxDate <span class="sc">%m+%</span> <span class="fu">months</span>(<span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb92-7"><a href="#cb92-7"></a>               <span class="at">Month2Before =</span> MaxDate <span class="sc">%m+%</span> <span class="fu">months</span>(<span class="sc">-</span><span class="dv">2</span>),</span>
<span id="cb92-8"><a href="#cb92-8"></a>               <span class="at">Month3Before =</span> MaxDate <span class="sc">%m+%</span> <span class="fu">months</span>(<span class="sc">-</span><span class="dv">3</span>)) </span>
<span id="cb92-9"><a href="#cb92-9"></a><span class="fu">head</span>(monthByMonth)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A grouped_df: 6 × 7</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">CustomerID</th>
<th data-quarto-table-cell-role="th" scope="col">Date</th>
<th data-quarto-table-cell-role="th" scope="col">UsdEquiv_sum</th>
<th data-quarto-table-cell-role="th" scope="col">MaxDate</th>
<th data-quarto-table-cell-role="th" scope="col">Month1Before</th>
<th data-quarto-table-cell-role="th" scope="col">Month2Before</th>
<th data-quarto-table-cell-role="th" scope="col">Month3Before</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;date&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;date&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;date&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;date&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;date&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>215454555</td>
<td>2019-03-15</td>
<td>6293.7111</td>
<td>2021-04-30</td>
<td>2021-03-30</td>
<td>2021-02-28</td>
<td>2021-01-30</td>
</tr>
<tr class="even">
<td>215454555</td>
<td>2019-04-05</td>
<td>914.9459</td>
<td>2021-04-30</td>
<td>2021-03-30</td>
<td>2021-02-28</td>
<td>2021-01-30</td>
</tr>
<tr class="odd">
<td>215454555</td>
<td>2019-05-30</td>
<td>2102.0570</td>
<td>2021-04-30</td>
<td>2021-03-30</td>
<td>2021-02-28</td>
<td>2021-01-30</td>
</tr>
<tr class="even">
<td>215454555</td>
<td>2019-10-09</td>
<td>10854.7630</td>
<td>2021-04-30</td>
<td>2021-03-30</td>
<td>2021-02-28</td>
<td>2021-01-30</td>
</tr>
<tr class="odd">
<td>215454555</td>
<td>2019-11-27</td>
<td>639.5389</td>
<td>2021-04-30</td>
<td>2021-03-30</td>
<td>2021-02-28</td>
<td>2021-01-30</td>
</tr>
<tr class="even">
<td>215454555</td>
<td>2019-12-20</td>
<td>2654.9459</td>
<td>2021-04-30</td>
<td>2021-03-30</td>
<td>2021-02-28</td>
<td>2021-01-30</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="2" type="1">
<li>Big guery calculate sums for each month and find increases</li>
</ol>
<div id="7c400ae7" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a>credetInc <span class="ot">&lt;-</span> monthByMonth <span class="sc">%&gt;%</span></span>
<span id="cb93-2"><a href="#cb93-2"></a>    <span class="fu">filter</span>(Date <span class="sc">&gt;=</span> Month1Before <span class="sc">&amp;</span> Date <span class="sc">&lt;=</span> MaxDate) <span class="sc">%&gt;%</span> <span class="co"># data in range from Month1Before to MaxDate</span></span>
<span id="cb93-3"><a href="#cb93-3"></a>    <span class="fu">group_by</span>(CustomerID) <span class="sc">%&gt;%</span></span>
<span id="cb93-4"><a href="#cb93-4"></a>    <span class="fu">summarise</span>(<span class="at">M1Sum =</span> <span class="fu">sum</span>(UsdEquiv_sum)) <span class="sc">%&gt;%</span> <span class="co"># sum for month -1</span></span>
<span id="cb93-5"><a href="#cb93-5"></a>    <span class="fu">left_join</span>(monthByMonth <span class="sc">%&gt;%</span> <span class="co"># join with data about month -2</span></span>
<span id="cb93-6"><a href="#cb93-6"></a>              <span class="fu">filter</span>(Date <span class="sc">&gt;=</span> Month2Before <span class="sc">&amp;</span> Date <span class="sc">&lt;=</span> Month1Before) <span class="sc">%&gt;%</span> <span class="co"># data in range from Month2Before to Month1Before</span></span>
<span id="cb93-7"><a href="#cb93-7"></a>              <span class="fu">group_by</span>(CustomerID) <span class="sc">%&gt;%</span></span>
<span id="cb93-8"><a href="#cb93-8"></a>              <span class="fu">summarise</span>(<span class="at">M2Sum =</span> <span class="fu">sum</span>(UsdEquiv_sum)), <span class="at">by =</span> <span class="st">"CustomerID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb93-9"><a href="#cb93-9"></a>            <span class="fu">left_join</span>(monthByMonth <span class="sc">%&gt;%</span> <span class="co"># join with data about month -3</span></span>
<span id="cb93-10"><a href="#cb93-10"></a>              <span class="fu">filter</span>(Date <span class="sc">&gt;=</span> Month3Before <span class="sc">&amp;</span> Date <span class="sc">&lt;=</span> Month2Before) <span class="sc">%&gt;%</span> <span class="co"># data in range from Month3Before to Month2Before</span></span>
<span id="cb93-11"><a href="#cb93-11"></a>              <span class="fu">group_by</span>(CustomerID) <span class="sc">%&gt;%</span></span>
<span id="cb93-12"><a href="#cb93-12"></a>              <span class="fu">summarise</span>(<span class="at">M3Sum =</span> <span class="fu">sum</span>(UsdEquiv_sum)), <span class="at">by =</span> <span class="st">"CustomerID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb93-13"><a href="#cb93-13"></a>    rowwise <span class="sc">%&gt;%</span> <span class="co"># calculate separately for each row, not for columns</span></span>
<span id="cb93-14"><a href="#cb93-14"></a>    <span class="fu">mutate</span>(<span class="at">AverageIncrease3M_Credet =</span> <span class="fu">mean</span>(<span class="fu">c</span>(M1Sum<span class="sc">/</span>M2Sum, M2Sum<span class="sc">/</span>M3Sum), <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span> <span class="co"># increase is an average of sum changinf from month to month</span></span>
<span id="cb93-15"><a href="#cb93-15"></a>    <span class="fu">select</span>(CustomerID, AverageIncrease3M_Credet)</span>
<span id="cb93-16"><a href="#cb93-16"></a>        </span>
<span id="cb93-17"><a href="#cb93-17"></a><span class="fu">head</span>(credetInc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A rowwise_df: 4 × 2</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">CustomerID</th>
<th data-quarto-table-cell-role="th" scope="col">AverageIncrease3M_Credet</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>215454555</td>
<td>8.3372521811</td>
</tr>
<tr class="even">
<td>456415151</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td>787987456</td>
<td>0.0003175611</td>
</tr>
<tr class="even">
<td>985121122</td>
<td>NaN</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Join all the tables</p>
<div id="18e3c041" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1"></a>final_set <span class="ot">&lt;-</span> demographics <span class="sc">%&gt;%</span> </span>
<span id="cb94-2"><a href="#cb94-2"></a>        <span class="fu">left_join</span>(avgContractSum3m , <span class="at">by =</span> <span class="st">"CustomerID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-3"><a href="#cb94-3"></a>        <span class="fu">left_join</span>(credetInc , <span class="at">by =</span> <span class="st">"CustomerID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-4"><a href="#cb94-4"></a>        <span class="fu">left_join</span>(churn_eval, <span class="at">by =</span> <span class="st">"CustomerID"</span>)</span>
<span id="cb94-5"><a href="#cb94-5"></a>final_set</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 4 × 7</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">CustomerID</th>
<th data-quarto-table-cell-role="th" scope="col">Gender</th>
<th data-quarto-table-cell-role="th" scope="col">Email</th>
<th data-quarto-table-cell-role="th" scope="col">VisitsLastYear</th>
<th data-quarto-table-cell-role="th" scope="col">AverageContractSum3M_Credet</th>
<th data-quarto-table-cell-role="th" scope="col">AverageIncrease3M_Credet</th>
<th data-quarto-table-cell-role="th" scope="col">Churn</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>787987456</td>
<td>Male</td>
<td>Yes</td>
<td>12</td>
<td>116.6667</td>
<td>0.0003175611</td>
<td>1</td>
</tr>
<tr class="even">
<td>456415151</td>
<td>Male</td>
<td>NULL</td>
<td>0</td>
<td>1271.5930</td>
<td>NaN</td>
<td>1</td>
</tr>
<tr class="odd">
<td>215454555</td>
<td>Female</td>
<td>No</td>
<td>16</td>
<td>45541.3335</td>
<td>8.3372521811</td>
<td>0</td>
</tr>
<tr class="even">
<td>985121122</td>
<td>Female</td>
<td>No</td>
<td>4</td>
<td>4444.4444</td>
<td>NaN</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>On the next stages this data can be transformed with scaling, encoding, binning.</p>
<hr>
</section>
</section>
</section>
<section id="references" class="level2" data-number="25.5">
<h2 data-number="25.5" class="anchored" data-anchor-id="references"><span class="header-section-number">25.5</span> References</h2>
<ol type="1">
<li><a href="https://www.geeksforgeeks.org/feature-engineering-in-r-programming/">Feature Engineering in R Programming</a> by <span class="citation" data-cites="dhruv5819">(<a href="references.html#ref-dhruv5819" role="doc-biblioref"><strong>dhruv5819?</strong></a>)</span></li>
<li><a href="https://www.displayr.com/what-is-feature-engineering/">What is Feature Engineering?</a> by Tim Bok</li>
<li><a href="https://medium.com/@rahul77349/feature-scaling-why-it-is-required-8a93df1af310">Feature Scaling-Why it is required?</a> by Rahul Saini</li>
<li><a href="https://www.analyticsvidhya.com/blog/2020/04/feature-scaling-machine-learning-normalization-standardization/">Feature Scaling for Machine Learning: Understanding the Difference Between Normalization vs.&nbsp;Standardization</a> by ANIRUDDHA BHANDARI</li>
<li><a href="https://blog.revolutionanalytics.com/2015/03/r-package-smbinning-optimal-binning-for-scoring-modeling.html">R Package ‘smbinning’: Optimal Binning for Scoring Modeling by Herman Jopia</a></li>
<li>Garcia, S. et al (2013) A Survey of Discretization Techniques: Taxonomy and Empirical Analysis in Supervised Learning. IEEE Transactions on Knowledge and Data Engineering, Vol. 25, No.&nbsp;4, April 2013.</li>
<li><a href="https://arxiv.org/pdf/2006.11835.pdf">An Overview on the Landscape of R Packages for Credit Scoring by Gero Szepannek</a></li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/kleban\.github\.io\/data-r\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./44-r-outliers.html" class="pagination-link" aria-label="Аналіз та обробка статистичних викидів у даних">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Аналіз та обробка статистичних викидів у даних</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./train-test-validation-samples.html" class="pagination-link" aria-label="Data Split: Train, Test and Validation sets">
        <span class="nav-page-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Data Split: Train, Test and Validation sets</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2024, Юрій Клебан</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>